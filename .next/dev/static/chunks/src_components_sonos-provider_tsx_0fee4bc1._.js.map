{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ollie/Documents/dev/musicStreamer/src/components/sonos-provider.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\n\ninterface SonosContextType {\n  households: any[];\n  groups: any[];\n  favorites: any[];\n  currentGroup: any | null;\n  playbackState: any | null;\n  volume: number;\n  isExpanded: boolean;\n  currentPage: string;\n  setIsExpanded: (expanded: boolean) => void;\n  setCurrentPage: (page: string) => void;\n  setCurrentGroup: (group: any) => void;\n  setVolume: (volume: number) => Promise<void>;\n  refreshState: () => Promise<void>;\n}\n\nconst SonosContext = createContext<SonosContextType | undefined>(undefined);\n\nexport function SonosProvider({ children }: { children: React.ReactNode }) {\n  const [households, setHouseholds] = useState<any[]>([]);\n  const [groups, setGroups] = useState<any[]>([]);\n  const [favorites, setFavorites] = useState<any[]>([]);\n  const [currentGroup, setCurrentGroup] = useState<any | null>(null);\n  const [playbackState, setPlaybackState] = useState<any | null>(null);\n  const [volume, setVolumeState] = useState<number>(50);\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [currentPage, setCurrentPage] = useState<string>(\"Feed\");\n\n  const refreshState = async () => {\n    try {\n      const res = await fetch(\"/api/sonos/state\");\n      if (!res.ok) return;\n      const data = await res.json();\n      \n      setHouseholds(data.households || []);\n      \n      // Stable sort for groups to prevent jumping UI\n      const sortedGroups = (data.groups || []).sort((a: any, b: any) => \n        a.name.localeCompare(b.name)\n      );\n      setGroups(sortedGroups);\n      \n      // Stable sort for favorites\n      const sortedFavorites = (data.favorites || []).sort((a: any, b: any) => \n        a.name.localeCompare(b.name)\n      );\n      setFavorites(sortedFavorites);\n      \n      if (!currentGroup && data.groups?.length > 0) {\n        setCurrentGroup(data.groups[0]);\n      } else if (currentGroup) {\n        // Update current group state from fresh groups list\n        const updatedGroup = data.groups.find((g: any) => g.id === currentGroup.id);\n        if (updatedGroup) setCurrentGroup(updatedGroup);\n      }\n\n      if (currentGroup) {\n        const [pbRes, volRes] = await Promise.all([\n          fetch(`/api/sonos/playback?groupId=${currentGroup.id}`),\n          fetch(`/api/sonos/volume?groupId=${currentGroup.id}`)\n        ]);\n        \n        if (pbRes.ok) {\n          const pbData = await pbRes.json();\n          setPlaybackState(pbData);\n        }\n        \n        if (volRes.ok) {\n          const volData = await volRes.json();\n          setVolumeState(volData.volume || 50);\n        }\n      }\n    } catch (err) {\n      console.error(\"Failed to fetch Sonos state\", err);\n    }\n  };\n\n  const setVolume = async (newVolume: number) => {\n    if (!currentGroup) return;\n    setVolumeState(newVolume);\n    await fetch(`/api/sonos/control?groupId=${currentGroup.id}&volume=${newVolume}`, { method: \"POST\" });\n  };\n\n  useEffect(() => {\n    refreshState();\n    const interval = setInterval(refreshState, 5000); // Poll every 5 seconds\n    return () => clearInterval(interval);\n  }, [currentGroup?.id]);\n\n  return (\n    <SonosContext.Provider\n      value={{\n        households,\n        groups,\n        favorites,\n        currentGroup,\n        playbackState,\n        volume,\n        isExpanded,\n        currentPage,\n        setIsExpanded,\n        setCurrentPage,\n        setCurrentGroup,\n        setVolume,\n        refreshState,\n      }}\n    >\n      {children}\n    </SonosContext.Provider>\n  );\n}\n\nexport function useSonos() {\n  const context = useContext(SonosContext);\n  if (context === undefined) {\n    throw new Error(\"useSonos must be used within a SonosProvider\");\n  }\n  return context;\n}\n"],"names":[],"mappings":"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"}}]
}