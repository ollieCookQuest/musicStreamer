(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52729,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let o=(0,r.createContext)(void 0);function n(e,t){if(e===t)return!0;if(null==e||null==t||"object"!=typeof e||"object"!=typeof t)return!1;let r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(let a of r)if(!o.includes(a)||!n(e[a],t[a]))return!1;return!0}function a({children:e}){let[a,s]=(0,r.useState)([]),[l,i]=(0,r.useState)([]),[u,c]=(0,r.useState)([]),[d,f]=(0,r.useState)(null),[p,h]=(0,r.useState)(null),[v,y]=(0,r.useState)(50),[g,m]=(0,r.useState)(!1),[S,k]=(0,r.useState)("Feed"),[w,b]=(0,r.useState)([]),C=(0,r.useRef)(!1),j=(0,r.useRef)(null),E=(0,r.useRef)(null),P=(0,r.useRef)({households:[],groups:[],favorites:[],playbackState:null,volume:50});(0,r.useEffect)(()=>{E.current=d},[d]);let T=(0,r.useCallback)(async e=>{try{await fetch("/api/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"currentZoneId",value:e})})}catch(e){console.error("Failed to save zone preference:",e)}},[]),O=(0,r.useCallback)(async e=>{try{await fetch("/api/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"selectedZoneIds",value:JSON.stringify(e)})})}catch(e){console.error("Failed to save selected zones preference:",e)}},[]),I=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/preferences?key=currentZoneId");if(e.ok)return(await e.json()).value}catch(e){console.error("Failed to load zone preference:",e)}return null},[]),D=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/preferences?key=selectedZoneIds");if(e.ok){let t=await e.json();if(t.value)return JSON.parse(t.value)}}catch(e){console.error("Failed to load selected zones preference:",e)}return[]},[]),F=(0,r.useCallback)(async()=>{if(!C.current){C.current=!0;try{let e=await fetch("/api/sonos/state");if(!e.ok)return;let t=await e.json();n(P.current.households,t.households||[])||(s(t.households||[]),P.current.households=t.households||[]);let r=(t.groups||[]).sort((e,t)=>e.name.localeCompare(t.name));n(P.current.groups,r)||(i(r),P.current.groups=r);let o=(t.favorites||[]).sort((e,t)=>e.name.localeCompare(t.name));n(P.current.favorites,o)||(c(o),P.current.favorites=o);let a=E.current;if(!a&&t.groups?.length>0){let e=await I(),r=await D(),o=null;if(r.length>0){let e=r.filter(e=>t.groups.some(t=>t.id===e));e.length>0&&(b(e),o=t.groups.find(t=>t.id===e[0]))}!o&&e&&(o=t.groups.find(t=>t.id===e));let n=o||t.groups[0];f(n),0===r.length&&b([n.id])}else if(a){let e=t.groups.find(e=>e.id===a.id);if(e&&!n(a,e))f(e),w.includes(e.id)||b([e.id]);else if(!e){let e=await I(),r=null;e&&(r=t.groups.find(t=>t.id===e));let o=r||t.groups[0];o&&(f(o),b([o.id]))}}let l=a?.id;if(l){l!==j.current&&(j.current=l);let[e,t]=await Promise.all([fetch(`/api/sonos/playback?groupId=${l}`),fetch(`/api/sonos/volume?groupId=${l}`)]);if(410===e.status||410===t.status){let e=await fetch("/api/sonos/state");if(e.ok){let t=((await e.json()).groups||[]).sort((e,t)=>e.name.localeCompare(t.name));i(t);let r=a?.name,o=r?t.find(e=>e.name===r):t[0];o?(f(o),w.includes(a.id)&&b([o.id])):t.length>0&&(f(t[0]),b([t[0].id]))}return}if(e.ok){let t=await e.json();h(t),P.current.playbackState=t}if(t.ok){let e=(await t.json()).volume||50;y(e),P.current.volume=e}}}catch(e){console.error("Failed to fetch Sonos state",e)}finally{C.current=!1}}},[I,D]),x=async e=>{d&&(y(e),410===(await fetch(`/api/sonos/control?groupId=${d.id}&volume=${e}`,{method:"POST"})).status&&await F())};return(0,r.useEffect)(()=>{F()},[]),(0,r.useEffect)(()=>{let e=setInterval(()=>{F()},1e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{d?.id&&F()},[d?.id]),(0,r.useEffect)(()=>{d?.id&&(0!==w.length&&w.includes(d.id)||b([d.id]),T(d.id))},[d?.id,T]),(0,r.useEffect)(()=>{w.length>0&&O(w)},[w,O]),(0,t.jsx)(o.Provider,{value:{households:a,groups:l,favorites:u,currentGroup:d,playbackState:p,volume:v,isExpanded:g,currentPage:S,selectedZoneIds:w,setIsExpanded:m,setCurrentPage:k,setCurrentGroup:f,setVolume:x,setSelectedZoneIds:b,toggleZone:e=>{b(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},refreshState:F},children:e})}function s(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useSonos must be used within a SonosProvider");return e}e.s(["SonosProvider",()=>a,"useSonos",()=>s])},94436,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let o=(0,r.createContext)(void 0),n={theWall:{name:"TheWall",screenSize:'10.1"',resolution:"1280×800",orientation:"landscape"},theDesk:{name:"TheDesk",screenSize:'10.1"',resolution:"1280×800",orientation:"landscape"}};function a({children:e}){let[a,s]=(0,r.useState)(null),[l,i]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/preferences?key=deviceType");if(e.ok){let t=await e.json();t.value&&("theWall"===t.value||"theDesk"===t.value)&&s(t.value)}}catch(e){console.error("Failed to load device preference:",e)}finally{i(!1)}})()},[]);let u=a?n[a]:null;return(0,r.useEffect)(()=>{a?document.documentElement.setAttribute("data-device",a):document.documentElement.removeAttribute("data-device")},[a]),(0,t.jsx)(o.Provider,{value:{deviceType:a,isLoading:l,deviceConfig:u,deviceClass:e=>a?"string"==typeof e?e:e[a]||e.default||"":"string"==typeof e?e:""},children:e})}function s(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useDevice must be used within a DeviceProvider");return e}e.s(["DeviceProvider",()=>a,"useDevice",()=>s])}]);