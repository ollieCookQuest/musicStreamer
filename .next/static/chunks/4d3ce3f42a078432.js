(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75170,e=>{"use strict";var t=e.i(43476),r=e.i(52729),a=e.i(94436),s=e.i(19455),o=e.i(75254);let i=(0,o.default)("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),n=(0,o.default)("panels-top-left",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);var l=e.i(9778),c=e.i(43531);let d=(0,o.default)("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);var u=e.i(75157),m=e.i(46932),p=e.i(71645);let h=[{icon:i,label:"Feed",page:"Feed"},{icon:n,label:"Library",page:"Library"}];function f({isCollapsed:e}){let{groups:a,currentGroup:o,setCurrentGroup:i,currentPage:n,setCurrentPage:f,selectedZoneIds:x,toggleZone:g,setSelectedZoneIds:y,refreshState:v}=(0,r.useSonos)(),[j,b]=(0,p.useState)(!1),w=async()=>{if(!(x.length<2))try{console.log("Selected zone IDs:",x),console.log("Groups:",a);let e=[];for(let t of x){let r=a.find(e=>e.id===t);if(console.log(`Processing zone ${t}:`,r),r){if(r.players&&Array.isArray(r.players)&&r.players.forEach(t=>{let r=t.id||t.playerId||t.player?.id;console.log("Found player in group.players:",t,`ID: ${r}`),r&&!e.includes(r)&&e.push(r)}),r.playerIds&&Array.isArray(r.playerIds)&&r.playerIds.forEach(t=>{console.log(`Found playerId in group.playerIds: ${t}`),t&&!e.includes(t)&&e.push(t)}),r.id&&r.id.includes(":")){let t=r.id.split(":")[0];console.log(`Extracted player ID from group ID: ${t}`),t&&!e.includes(t)&&e.push(t)}r.coordinatorId&&!e.includes(r.coordinatorId)&&(console.log(`Found coordinatorId: ${r.coordinatorId}`),e.push(r.coordinatorId))}}if(0===e.length)return void console.error("No player IDs found for selected zones");let t=x[0];console.log("Grouping zones from sidebar:",{targetGroupId:t,playerIds:e});let r=await fetch("/api/sonos/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:t,playerIds:e})});if(!r.ok){let e=await r.json().catch(()=>({error:"Failed to parse error response"}));console.error("Group API error:",{status:r.status,statusText:r.statusText,error:e}),alert(`Failed to group zones: ${e.error||e.details||"Unknown error"}`);return}await v(),await new Promise(e=>setTimeout(e,1e3)),await v();let s=(await fetch("/api/sonos/state").then(e=>e.json()).then(e=>e.groups||[])).find(e=>e.id===t);s&&(i(s),y([t]),b(!1))}catch(e){console.error("Failed to group zones:",e)}};return(0,t.jsxs)("div",{className:"flex flex-col h-full space-y-10 py-2",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-muted-foreground px-6",children:"System"}),(0,t.jsx)("nav",{className:"space-y-1 px-2",children:h.map(e=>{let r=n===e.page;return(0,t.jsxs)(s.Button,{variant:"ghost",onClick:()=>f(e.page),className:(0,u.cn)("w-full h-12 rounded-2xl transition-all duration-300 flex items-center justify-start px-4 group relative",r?"bg-foreground/[0.05] text-foreground shadow-sm":"text-muted-foreground hover:bg-foreground/[0.03] hover:text-foreground"),children:[(0,t.jsx)(e.icon,{className:(0,u.cn)("h-4 w-4 shrink-0 transition-transform duration-500",r?"scale-110":"group-hover:scale-110")}),(0,t.jsx)("span",{className:"font-black tracking-tight text-[11px] uppercase italic ml-4",children:e.label})]},e.label)})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6",children:[(0,t.jsx)("h3",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-muted-foreground",children:"Zones"}),j?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[x.length>1&&(0,t.jsxs)("button",{onClick:w,className:"text-[8px] font-black uppercase tracking-[0.2em] text-primary hover:text-foreground transition-colors flex items-center gap-1",children:[(0,t.jsx)(d,{className:"h-3 w-3"}),"Group"]}),(0,t.jsx)("button",{onClick:()=>{b(!1),y([])},className:"text-[8px] font-black uppercase tracking-[0.2em] text-muted-foreground hover:text-foreground transition-colors",children:"Done"})]}):(0,t.jsx)("button",{onClick:()=>b(!0),className:"text-[8px] font-black uppercase tracking-[0.2em] text-primary hover:text-foreground transition-colors",children:"Select"})]}),(0,t.jsx)("div",{className:"space-y-2 px-2",children:a.map(e=>{let r="PLAYBACK_STATE_PLAYING"===e.playbackState,a=o?.id===e.id,s=x.includes(e.id);return(0,t.jsxs)(m.motion.button,{onClick:t=>{j?(t.stopPropagation(),g(e.id)):(i(e),y([e.id]))},className:(0,u.cn)("w-full h-20 rounded-[2rem] transition-all duration-500 relative flex items-center px-4 overflow-hidden border",a&&!j?"bg-foreground/[0.06] text-foreground border-foreground/[0.1]":s&&j?"bg-primary/10 text-foreground border-primary/30":"bg-transparent text-muted-foreground hover:bg-foreground/[0.02] border-transparent"),whileHover:{scale:1.01},whileTap:{scale:.99},children:[a&&!j&&(0,t.jsx)(m.motion.div,{layoutId:"active-zone-indicator",className:"absolute left-0 top-0 bottom-0 w-0.5 bg-foreground"}),s&&j&&(0,t.jsx)(m.motion.div,{initial:{scale:0},animate:{scale:1},className:"absolute top-2 right-2 h-6 w-6 rounded-full bg-primary flex items-center justify-center shadow-md",children:(0,t.jsx)(c.Check,{className:"h-3.5 w-3.5 text-primary-foreground"})}),(0,t.jsxs)("div",{className:"relative shrink-0 flex items-center justify-center",children:[(0,t.jsx)("div",{className:(0,u.cn)("h-12 w-12 rounded-full flex items-center justify-center transition-all duration-500",a&&!j?"bg-foreground shadow-lg":s&&j?"bg-primary shadow-lg":"bg-foreground/[0.05]"),children:(0,t.jsx)(l.Waves,{className:(0,u.cn)("h-5 w-5 transition-colors duration-500",a&&!j||s&&j?"text-background":"text-muted-foreground")})}),r&&(0,t.jsx)(m.motion.div,{layoutId:`playing-dot-${e.id}`,className:"absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full bg-primary border-2 border-background shadow-sm",animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:2}})]}),(0,t.jsxs)("div",{className:"flex flex-col items-start ml-4 flex-1 min-w-0",children:[(0,t.jsx)("span",{className:(0,u.cn)("font-black text-sm tracking-tight uppercase italic transition-colors leading-none truncate w-full",a&&!j||s&&j?"text-foreground":"text-muted-foreground opacity-60"),children:e.name}),(0,t.jsx)("div",{className:"mt-2 h-3 flex items-center",children:r?(0,t.jsxs)("div",{className:"flex gap-0.5 items-end h-full",children:[(0,t.jsx)(m.motion.div,{animate:{height:[3,10,5,12,3]},transition:{repeat:1/0,duration:1},className:"w-0.5 bg-primary rounded-full"}),(0,t.jsx)(m.motion.div,{animate:{height:[6,3,10,3,8]},transition:{repeat:1/0,duration:.8},className:"w-0.5 bg-primary rounded-full"}),(0,t.jsx)(m.motion.div,{animate:{height:[8,12,3,12,6]},transition:{repeat:1/0,duration:1.2},className:"w-0.5 bg-primary rounded-full"})]}):(0,t.jsx)("span",{className:"text-[8px] font-black uppercase tracking-[0.2em] text-muted-foreground opacity-60 dark:opacity-40",children:"Standby"})})]})]},e.id)})})]})]})}let x=(0,o.default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),g=(0,o.default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),y=(0,o.default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),v=(0,o.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function j(){let{favorites:e,currentGroup:a,groups:o,refreshState:i,households:n,setCurrentPage:l}=(0,r.useSonos)(),[c,d]=(0,p.useState)(null),[u,h]=(0,p.useState)([]),[f,j]=(0,p.useState)(!1),b=async e=>{let t=a||(o&&o.length>0?o[0]:null);if(!t)return void console.error("No active zone available to play favorite");try{let r=await fetch(`/api/sonos/control?groupId=${t.id}&favoriteId=${e}`,{method:"POST"});if(r.ok)await i();else{let e=await r.json();console.error("Failed to play favorite:",e)}}catch(e){console.error("Error playing favorite:",e)}},w=async e=>{if(a&&n?.[0]){j(!0),d(e);try{let t=e.itemId?.objectId||e.itemId,r=e.itemId?.serviceId||e.serviceId,a=e.itemId?.accountId||e.accountId;if(!t||!r||!a){console.error("Missing favorite item information:",e),await b(e.id),d(null),j(!1);return}let s=await fetch(`/api/sonos/library/metadata?accountId=${a}&itemId=${encodeURIComponent(t)}&serviceId=${r}`);if(s.ok){let e=await s.json();if(e.containers||e.items){let t=[...(e.containers||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||r,accountId:e.accountId||a}})),...(e.items||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||r,accountId:e.accountId||a}}))];h(t),j(!1);return}}let o=await fetch(`/api/sonos/library?accountId=${a}&containerId=${encodeURIComponent(t)}`);if(o.ok){let e=await o.json(),t=[...(e.containers||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||r,accountId:e.accountId||a}})),...(e.items||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||r,accountId:e.accountId||a}}))];h(t)}else await b(e.id),d(null)}catch(t){console.error("Failed to browse favorite:",t),await b(e.id),d(null)}finally{j(!1)}}},k=async e=>{if(!a)return;let t=e.id?.objectId||e.objectId,r=e.id?.serviceId||e.serviceId,s=e.id?.accountId||e.accountId;if(!t||!r||!s)return void console.error("Missing track information:",e);try{(await fetch("/api/sonos/library/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:a.id,itemId:t,serviceId:r,accountId:s,action:"replace"})})).ok&&await i()}catch(e){console.error("Failed to play track:",e)}};return e&&0!==e.length?(0,t.jsxs)("div",{className:"space-y-20",children:[(0,t.jsxs)("div",{className:"flex items-end justify-between border-b border-foreground/10 dark:border-white/5 pb-10",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-[10px] font-black uppercase tracking-[0.6em] text-primary",children:"Discovery"}),(0,t.jsx)("h2",{className:"text-6xl lg:text-7xl font-black tracking-tighter italic uppercase leading-none",children:"Your Library"})]}),(0,t.jsx)("button",{className:"h-16 w-16 rounded-[2rem] bg-secondary/50 hover:bg-secondary flex items-center justify-center transition-all group border border-foreground/10 dark:border-white/5",children:(0,t.jsx)(y,{className:"h-6 w-6 group-hover:translate-x-1 transition-transform"})})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-x-12 gap-y-20",children:e.map((e,r)=>(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:.05*r,duration:1,ease:[.22,1,.36,1]},onClick:t=>{t.stopPropagation(),e.itemId||e.type?.includes("playlist")||e.type?.includes("container")?w(e):b(e.id)},className:"group cursor-pointer",children:[(0,t.jsxs)("div",{className:"relative aspect-[4/5] rounded-[3.5rem] lg:rounded-[4.5rem] overflow-hidden bg-secondary shadow-[0_40px_100px_-20px_rgba(0,0,0,0.3)] group-hover:shadow-[0_60px_120px_-30px_rgba(0,0,0,0.5)] transition-all duration-700 ease-[0.22,1,0.36,1]",children:[e.imageUrl?(0,t.jsx)("img",{src:e.imageUrl,alt:e.name,className:"object-cover w-full h-full transition-all duration-1000 group-hover:scale-110 grayscale-[30%] group-hover:grayscale-0 saturate-[0.8] group-hover:saturate-100"}):(0,t.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-foreground/5 text-9xl font-black italic select-none",children:"ART"})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-40 group-hover:opacity-60 transition-opacity duration-700"}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),b(e.id)},className:"absolute top-6 right-6 h-16 w-16 rounded-[2rem] bg-white dark:bg-foreground text-black dark:text-background flex items-center justify-center shadow-2xl hover:scale-110 transition-all duration-300 z-10","aria-label":"Play favorite",children:(0,t.jsx)(x,{className:"h-8 w-8 fill-current ml-1"})}),(0,t.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-end p-10 opacity-0 group-hover:opacity-100 transition-all duration-500 translate-y-4 group-hover:translate-y-0",children:[(0,t.jsx)("div",{className:`h-20 w-20 rounded-[2rem] bg-white/20 dark:bg-foreground/20 backdrop-blur-lg text-white flex items-center justify-center shadow-2xl mb-6 ${e.itemId||e.type?.includes("playlist")?"group-hover:scale-110 cursor-pointer":""}`,onClick:t=>{t.stopPropagation(),(e.itemId||e.type?.includes("playlist")||e.type?.includes("container"))&&w(e)},children:e.itemId||e.type?.includes("playlist")?(0,t.jsx)(v,{className:"h-8 w-8 fill-current"}):(0,t.jsx)(x,{className:"h-8 w-8 fill-current ml-1"})}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-white/80 dark:text-white/90",children:e.itemId||e.type?.includes("playlist")?"Browse Playlist":"Press to Play"}),(0,t.jsx)("p",{className:"text-white dark:text-white text-xl font-black italic uppercase leading-tight truncate",children:e.name})]})]})]}),(0,t.jsxs)("div",{className:"mt-10 px-6 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,t.jsx)("h3",{className:"font-black text-2xl lg:text-3xl tracking-tighter leading-none truncate uppercase italic group-hover:text-primary transition-colors duration-500",children:e.name}),(0,t.jsx)("p",{className:"text-sm font-bold text-muted-foreground uppercase tracking-widest mt-2 opacity-70 dark:opacity-60 truncate",children:e.description||"Collection"})]}),(0,t.jsx)("button",{className:"h-10 w-10 flex items-center justify-center text-muted-foreground hover:text-foreground transition-colors shrink-0",children:(0,t.jsx)(g,{className:"h-5 w-5 text-muted-foreground opacity-50 dark:opacity-40"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 pt-2",children:[(0,t.jsx)("div",{className:"h-px flex-1 bg-foreground/10 dark:bg-white/5 group-hover:bg-primary/30 dark:group-hover:bg-primary/20 transition-colors duration-700"}),(0,t.jsx)("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground opacity-60 dark:opacity-40",children:"Sonos Fav"})]})]})]},e.id))}),c&&(0,t.jsx)(m.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed inset-0 z-50 bg-background/95 backdrop-blur-xl flex items-center justify-center p-8",onClick:()=>{d(null),h([])},children:(0,t.jsxs)(m.motion.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},onClick:e=>e.stopPropagation(),className:"max-w-4xl w-full max-h-[80vh] overflow-y-auto no-scrollbar bg-foreground/[0.02] rounded-3xl border border-foreground/[0.05] p-8 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-4xl font-black uppercase italic tracking-tighter mb-2",children:c.name}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground uppercase tracking-widest",children:[u.length," ",1===u.length?"Track":"Tracks"]})]}),(0,t.jsx)(s.Button,{variant:"ghost",onClick:()=>{d(null),h([])},className:"h-12 w-12 rounded-full",children:(0,t.jsx)(y,{className:"h-6 w-6 rotate-180"})})]}),f?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)(x,{className:"h-8 w-8 animate-pulse text-primary"})}):u.length>0?(0,t.jsx)("div",{className:"space-y-2",children:u.map((e,r)=>{let a=e.name||e.title||e.track?.name,s=e.artist?.name||e.track?.artists?.map(e=>e.name).join(", "),o=e.imageUrl||e.images?.[0]?.url||e.track?.album?.images?.[0]?.url;return e.type?.includes("container")||e._objectType,(0,t.jsxs)(m.motion.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*r},onClick:()=>{k(e)},className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-foreground/[0.03] hover:bg-foreground/[0.06] border border-foreground/[0.05] hover:border-foreground/20 transition-all group text-left",children:[(0,t.jsx)("div",{className:"h-16 w-16 rounded-xl overflow-hidden flex-shrink-0 bg-secondary",children:o?(0,t.jsx)("img",{src:o,alt:a,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsx)(x,{className:"h-6 w-6 text-muted-foreground opacity-30"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-black text-sm uppercase italic truncate",children:a}),s&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-widest mt-1 truncate opacity-70",children:s})]}),(0,t.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(x,{className:"h-5 w-5 text-primary"})})]},e.id?.objectId||e.id||r)})}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-64",children:[(0,t.jsx)(x,{className:"h-16 w-16 text-muted-foreground opacity-20 mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground uppercase tracking-widest",children:"No tracks found"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"This playlist appears to be empty"})]})]})})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center space-y-10 animate-in fade-in zoom-in duration-1000",children:[(0,t.jsxs)("div",{className:"relative h-48 w-48 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-primary/5 blur-[60px] rounded-full animate-pulse"}),(0,t.jsx)(x,{className:"h-20 w-20 text-muted-foreground opacity-10"})]}),(0,t.jsxs)("div",{className:"space-y-3 max-w-sm",children:[(0,t.jsx)("h3",{className:"text-3xl font-black tracking-tight italic uppercase text-muted-foreground opacity-70 dark:opacity-60",children:"Your Gallery is Empty"}),(0,t.jsx)("p",{className:"text-muted-foreground font-bold text-sm tracking-tight leading-relaxed px-8 opacity-80 dark:opacity-70 uppercase",children:"Curate your collection in the Sonos app to display your favorites here."})]})]})}let b=(0,o.default)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),w=(0,o.default)("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),k=(0,o.default)("disc",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),N=(0,o.default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),I=(0,o.default)("list-music",[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M11 19H3",key:"zflm78"}],["path",{d:"M21 16V5",key:"yxg4q8"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),S=(0,o.default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),C=(0,o.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function P(){let{currentGroup:e,refreshState:a,favorites:o,households:i}=(0,r.useSonos)(),[n,l]=(0,p.useState)(!1),[c,d]=(0,p.useState)(null),[u,h]=(0,p.useState)([]),[f,g]=(0,p.useState)([]),y=async t=>{if(!e)return;if(!t||0===Object.keys(t).length)return void console.error("Cannot play empty item");if(t.id&&!c&&!t.itemId)try{if((await fetch(`/api/sonos/control?groupId=${e.id}&favoriteId=${t.id}`,{method:"POST"})).ok)return void await a()}catch(e){console.error("Failed to load favorite:",e)}let r=t.id?.objectId||t.objectId||t.track?.id?.objectId||t.track?.id,s=t.id?.serviceId||t.serviceId||t.track?.id?.serviceId||t.track?.serviceId,o=t.id?.accountId||t.accountId||t.track?.id?.accountId||t.track?.accountId;if(s&&o||!c||(s=s||c.id?.serviceId||c.serviceId,o=o||c.id?.accountId||c.accountId),!r)return void console.error("Missing item ID:",t);if(!s||!o)return void console.error("Missing serviceId or accountId. Item:",t,"Browsing container:",c);try{(await fetch("/api/sonos/library/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:e.id,itemId:r,serviceId:s,accountId:o,action:"replace"})})).ok&&await a()}catch(e){console.error("Failed to play item:",e)}},j=async t=>{if(!e)return;let r=t.id?.objectId||t.objectId,s=t.id?.serviceId||t.serviceId,o=t.id?.accountId||t.accountId,i=t.name||t.title;if(!r||!s||!o||!i)return void console.error("Missing item information:",t);try{(await fetch("/api/sonos/library/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:e.id,itemId:r,serviceId:s,accountId:o,name:i,action:"addToFavorites"})})).ok&&await a()}catch(e){console.error("Failed to add to favorites:",e)}},P=async(t,r=!0)=>{if(!e||!i?.[0])return;if(!t||0===Object.keys(t).length)return void console.error("Cannot browse empty item");let s=t.containerId||t.id?.objectId||t.objectId||t.track?.id?.objectId||t.track?.id,o=t.id?.serviceId||t.serviceId||t.track?.id?.serviceId||t.track?.serviceId,n=t.id?.accountId||t.accountId||t.track?.id?.accountId||t.track?.accountId;if(t.id&&!c&&t.itemId){let e=t.itemId?.objectId||t.itemId,r=t.itemId?.serviceId||t.serviceId,a=t.itemId?.accountId||t.accountId;e&&r&&a&&(s=e,o=r,n=a)}if(!s||!o||!n){console.error("Missing item information for browsing:",t),t.id&&await y(t);return}l(!0),d(t),r&&g([...f,t]);try{if(console.log("Browsing container with:",{itemId:s,serviceId:o,accountId:n,item:t}),t.id&&!c&&(console.log("This is a favorite, trying to load it first..."),(await fetch(`/api/sonos/control?groupId=${e.id}&favoriteId=${t.id}`,{method:"POST"})).ok)){await new Promise(e=>setTimeout(e,1e3));let t=await fetch(`/api/sonos/playback?groupId=${e.id}`);if(t.ok){let e=await t.json();if(console.log("Playback data after loading favorite:",e),e.container?.id){let t=e.container.id.objectId||e.container.id,r=e.container.id.serviceId||e.container.service?.id,s=e.container.id.accountId||n;console.log("Found container from playback:",{containerId:t,containerServiceId:r,containerAccountId:s});let o=await fetch(`/api/sonos/library?accountId=${s}&containerId=${encodeURIComponent(t)}`);if(o.ok){let e=await o.json();console.log("Browse result:",e);let t=[...(e.containers||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||r,accountId:e.accountId||s}})),...(e.items||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||r,accountId:e.accountId||s}}))];h(t),l(!1),await a();return}}}}console.log("Trying metadata endpoint...");let r=await fetch(`/api/sonos/library/metadata?accountId=${n}&itemId=${encodeURIComponent(s)}&serviceId=${o}`);if(r.ok){let e=await r.json();if(console.log("Metadata result:",e),e.containers||e.items){let t=[...(e.containers||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||o,accountId:e.accountId||n}})),...(e.items||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||o,accountId:e.accountId||n}}))];console.log("Setting container items from metadata:",t),h(t),l(!1);return}}else{let e=await r.json().catch(()=>({}));console.error("Metadata request failed:",e)}console.log("Trying browse endpoint...");let i=await fetch(`/api/sonos/library?accountId=${n}&containerId=${encodeURIComponent(s)}`);if(i.ok){let e=await i.json();console.log("Browse result:",e);let t=[...(e.containers||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||o,accountId:e.accountId||n}})),...(e.items||[]).map(e=>({...e,id:e.id||{objectId:e.objectId,serviceId:e.serviceId||o,accountId:e.accountId||n}}))];console.log("Setting container items from browse:",t),h(t)}else{let e=await i.json().catch(()=>({}));console.error("Browse failed:",e),await y(t),d(null),g([])}}catch(e){console.error("Failed to browse container:",e),await y(t),d(null),g([])}finally{l(!1)}},$=o.filter(e=>e&&Object.keys(e).length>0&&(e.name||e.title||e.id)),M=u.filter(e=>e&&Object.keys(e).length>0&&(e.name||e.title||e.id)),A=c?M:$;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-3xl font-black uppercase italic tracking-tighter mb-2",children:c?c.name:"Your Library"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground uppercase tracking-widest",children:c?"Contents":"Sonos Favorites"})]}),c&&(0,t.jsxs)(s.Button,{variant:"ghost",onClick:()=>{if(f.length>1){let e=f.slice(0,-1),t=e[e.length-1];g(e),P(t,!1)}else d(null),h([]),g([])},className:"flex items-center gap-2",children:[(0,t.jsx)(C,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs font-black uppercase tracking-widest",children:"Back"})]})]}),f.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)("button",{onClick:()=>{d(null),h([]),g([])},className:"hover:text-foreground transition-colors",children:"Library"}),f.map((e,r)=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v,{className:"h-4 w-4"}),(0,t.jsx)("button",{onClick:()=>{g(f.slice(0,r+1)),r<f.length-1&&P(e,!1)},className:"hover:text-foreground transition-colors truncate max-w-[200px]",children:e.name})]},r))]}),n?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)(S,{className:"h-8 w-8 animate-spin text-primary"})}):A.length>0?(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:A.filter(e=>e&&Object.keys(e).length>0&&(e.name||e.title||e.id)).map((e,r)=>((e,r,a)=>{let o;if(!e||0===Object.keys(e).length)return null;let i=(o=e.type||e._objectType||"").includes("album")?k:o.includes("artist")?N:o.includes("playlist")||o.includes("container")?I:w,n=e.imageUrl||e.images?.[0]?.url||e.track?.album?.images?.[0]?.url,l=e.name||e.title||e.track?.name,d=e.type?.includes("container")||"container"===e._objectType||e.type?.includes("playlist")||e.type?.includes("album")||void 0!==e.containerId||e.itemId&&("container"===e.itemId.type||"container"===e.itemId._objectType)||e.id&&e.itemId&&!c||l&&(l.toLowerCase().includes("playlist")||l.toLowerCase().includes("album"))||e.description&&e.description.toLowerCase().includes("track");return(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},className:"group relative",children:[(0,t.jsxs)("div",{className:"aspect-square rounded-2xl overflow-hidden bg-foreground/[0.03] border border-foreground/[0.05] hover:border-foreground/20 transition-all cursor-pointer",onClick:t=>{(t.stopPropagation(),e&&0!==Object.keys(e).length)?(console.log("Item clicked:",e,"isContainer:",d),d||!c&&e.id&&e.itemId?(console.log("Attempting to browse container:",e),P(e)):(!c&&e.id?console.log("Playing favorite:",e):console.log("Playing item:",e),y(e))):console.error("Cannot interact with empty item")},children:[n?(0,t.jsx)("img",{src:n,alt:l,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsx)(i,{className:"h-12 w-12 text-muted-foreground"})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60 dark:bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-4",children:d?(0,t.jsx)(s.Button,{variant:"default",size:"icon",className:"h-14 w-14 rounded-full bg-foreground text-background",onClick:t=>{t.stopPropagation(),console.log("Browse button clicked for:",e),P(e)},children:(0,t.jsx)(v,{className:"h-6 w-6"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.Button,{variant:"default",size:"icon",className:"h-14 w-14 rounded-full bg-foreground text-background",onClick:t=>{t.stopPropagation(),console.log("Play button clicked for:",e),y(e)},children:(0,t.jsx)(x,{className:"h-6 w-6 fill-current ml-0.5"})}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-full bg-white/20 dark:bg-white/10 text-white hover:bg-white/30 dark:hover:bg-white/20",onClick:t=>{t.stopPropagation(),j(e)},children:(0,t.jsx)(b,{className:"h-5 w-5"})})]})})]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("p",{className:"font-black text-xs uppercase italic truncate",children:l}),(e.artist?.name||e.track?.artists?.[0]?.name)&&(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest mt-1 truncate",children:e.artist?.name||e.track?.artists?.map(e=>e.name).join(", ")}),d&&(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest mt-1 opacity-60",children:e.type||e._objectType||"Container"})]})]},e.id?.objectId||e.id||r)})(e,r)).filter(Boolean)}):c?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 bg-foreground/[0.02] rounded-3xl border border-foreground/[0.05]",children:[(0,t.jsx)(w,{className:"h-16 w-16 text-muted-foreground opacity-30 dark:opacity-20 mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground uppercase tracking-widest mb-2 text-center",children:"No Items Found"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center max-w-md px-4",children:"This container appears to be empty or cannot be browsed."})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 bg-foreground/[0.02] rounded-3xl border border-foreground/[0.05]",children:[(0,t.jsx)(w,{className:"h-16 w-16 text-muted-foreground opacity-30 dark:opacity-20 mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground uppercase tracking-widest mb-2 text-center",children:"No Favorites Yet"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center max-w-md px-4 mb-4",children:"Add favorites in the Sonos app to see them here."}),(0,t.jsxs)("div",{className:"bg-foreground/[0.03] rounded-2xl p-4 border border-foreground/[0.05] max-w-md",children:[(0,t.jsx)("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-primary mb-2",children:"How to Add Favorites"}),(0,t.jsxs)("ol",{className:"text-xs text-muted-foreground space-y-1 list-decimal list-inside text-left",children:[(0,t.jsx)("li",{children:"Open the Sonos app"}),(0,t.jsx)("li",{children:"Browse and play music"}),(0,t.jsx)("li",{children:"Add items to favorites (heart icon)"}),(0,t.jsx)("li",{children:"Return here to see your favorites"})]})]})]})]})}let $=(0,o.default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),M=(0,o.default)("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),A=(0,o.default)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),z=(0,o.default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var T=e.i(51445);let E=(0,o.default)("tv",[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]]),R=(0,o.default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),F=(0,o.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function O(){let{refreshState:e}=(0,r.useSonos)(),{deviceType:o,deviceConfig:i}=(0,a.useDevice)(),[n,l]=(0,p.useState)(!1),[d,u]=(0,p.useState)(!1),[h,f]=(0,p.useState)(!0),[x,g]=(0,p.useState)(!1),[y,v]=(0,p.useState)(!1);(0,p.useEffect)(()=>{j()},[]);let j=async()=>{f(!0);try{let e=await fetch("/api/sonos/state");l(e.ok)}catch(e){l(!1)}f(!1)},b=async()=>{window.location.href="/api/sonos/login"},w=async()=>{u(!0);try{(await fetch("/api/sonos/disconnect",{method:"POST"})).ok&&(l(!1),await j(),window.location.href="/setup")}catch(e){console.error("Failed to disconnect Sonos:",e)}finally{u(!1)}},k=async()=>{g(!0);try{let e=await fetch("/api/reset-device",{method:"POST"});if(e.ok)window.location.href="/setup";else{let t=await e.json();console.error("Failed to reset device:",t),alert("Failed to reset device. Please try again."),g(!1),v(!1)}}catch(e){console.error("Failed to reset device:",e),alert("Failed to reset device. Please try again."),g(!1),v(!1)}};return h?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)(S,{className:"h-8 w-8 animate-spin text-primary"})}):(0,t.jsxs)("div",{className:"space-y-8 max-w-4xl",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-4xl font-black uppercase italic tracking-tighter mb-2",children:"Settings"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground uppercase tracking-widest",children:"Manage your connections"})]}),(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-3xl bg-foreground/[0.02] border border-foreground/[0.05] p-8 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"h-16 w-16 rounded-2xl bg-foreground/[0.05] flex items-center justify-center relative overflow-hidden",children:"theWall"===o?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(E,{className:"h-8 w-8 text-foreground"}),(0,t.jsxs)("div",{className:"absolute -top-1 left-0 right-0 flex justify-between px-1",children:[(0,t.jsx)("div",{className:"h-1 w-1 rounded-full bg-foreground/40"}),(0,t.jsx)("div",{className:"h-1 w-1 rounded-full bg-foreground/40"})]})]})}):"theDesk"===o?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,t.jsx)(T.Monitor,{className:"h-6 w-6 text-foreground mb-0.5"}),(0,t.jsxs)("div",{className:"flex items-center gap-0.5 mt-0.5",children:[(0,t.jsx)("div",{className:"h-1 w-3 bg-foreground/30 rounded-sm"}),(0,t.jsx)("div",{className:"h-1 w-2 bg-foreground/40 rounded-sm"}),(0,t.jsx)("div",{className:"h-1 w-3 bg-foreground/30 rounded-sm"})]})]}):(0,t.jsx)($,{className:"h-6 w-6 text-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-black uppercase italic tracking-tighter",children:"Device"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-widest mt-1",children:"Your device configuration"})]})]}),i?(0,t.jsxs)("div",{className:"pt-4 border-t border-foreground/[0.05] space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground uppercase tracking-widest",children:"Device Name"}),(0,t.jsx)("span",{className:"font-black text-foreground",children:i.name})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground uppercase tracking-widest",children:"Screen Size"}),(0,t.jsx)("span",{className:"font-black text-foreground",children:i.screenSize})]})]}):(0,t.jsx)("div",{className:"pt-4 border-t border-foreground/[0.05]",children:(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No device configured. Please select a device during setup."})})]}),(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-3xl bg-foreground/[0.02] border border-foreground/[0.05] p-8 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-2xl bg-foreground/[0.05] flex items-center justify-center",children:(0,t.jsx)(M,{className:"h-6 w-6 text-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-black uppercase italic tracking-tighter",children:"Sonos Account"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-widest mt-1",children:"Control your Sonos speakers"})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-3",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20",children:[(0,t.jsx)(c.Check,{className:"h-4 w-4 text-primary"}),(0,t.jsx)("span",{className:"text-xs font-black uppercase tracking-widest text-primary",children:"Connected"})]}),(0,t.jsxs)(s.Button,{variant:"ghost",onClick:w,disabled:d,className:"px-6 py-2 rounded-2xl",children:[(0,t.jsx)(A,{className:"h-4 w-4 mr-2"}),"Disconnect"]})]}):(0,t.jsx)(s.Button,{onClick:b,className:"px-6 py-2 rounded-2xl bg-foreground text-background font-black uppercase tracking-widest",children:"Connect Sonos"})})]}),n&&(0,t.jsxs)("div",{className:"pt-4 border-t border-foreground/[0.05]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground uppercase tracking-widest",children:"Status"}),(0,t.jsx)("span",{className:"font-black text-foreground",children:"Active"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm mt-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground uppercase tracking-widest",children:"Last Sync"}),(0,t.jsx)("span",{className:"font-black text-foreground",children:"Just now"})]})]})]}),(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-3xl bg-red-500/5 border border-red-500/20 p-8 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-2xl bg-red-500/10 flex items-center justify-center",children:(0,t.jsx)(R,{className:"h-6 w-6 text-red-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-black uppercase italic tracking-tighter text-red-500",children:"Reset Device"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-widest mt-1",children:"Factory reset - removes all configuration"})]})]}),(0,t.jsxs)("div",{className:"pt-4 border-t border-red-500/20",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"This will remove your device configuration and Sonos account. You will need to set up the device again from scratch."}),y?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-2xl bg-red-500/10 border border-red-500/20",children:[(0,t.jsx)(F,{className:"h-5 w-5 text-red-500 mt-0.5 shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-bold text-red-500 mb-1",children:"Are you sure?"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"This action cannot be undone. All device settings and Sonos account will be permanently removed."})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(s.Button,{variant:"ghost",onClick:()=>v(!1),disabled:x,className:"px-6 py-2 rounded-2xl",children:"Cancel"}),(0,t.jsx)(s.Button,{onClick:k,disabled:x,className:"px-6 py-2 rounded-2xl bg-red-500 text-white hover:bg-red-600 font-black uppercase tracking-widest",children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S,{className:"h-4 w-4 mr-2 animate-spin"}),"Resetting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R,{className:"h-4 w-4 mr-2"}),"Confirm Reset"]})})]})]}):(0,t.jsxs)(s.Button,{variant:"ghost",onClick:()=>v(!0),className:"px-6 py-2 rounded-2xl border border-red-500/30 text-red-500 hover:bg-red-500/10 hover:border-red-500/50 transition-all",children:[(0,t.jsx)(R,{className:"h-4 w-4 mr-2"}),"Reset Device"]})]})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)(s.Button,{variant:"ghost",onClick:j,className:"px-6 py-2 rounded-2xl",children:[(0,t.jsx)(z,{className:"h-4 w-4 mr-2"}),"Refresh Status"]})})]})}let _=(0,o.default)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]),B=(0,o.default)("skip-back",[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]]),D=(0,o.default)("skip-forward",[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]]),L=(0,o.default)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),U=(0,o.default)("shuffle",[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]]),H=(0,o.default)("repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);function q(e,[t,r]){return Math.min(r,Math.max(t,e))}function G(e,t,{checkForDefaultPrevented:r=!0}={}){return function(a){if(e?.(a),!1===r||!a.defaultPrevented)return t?.(a)}}"undefined"!=typeof window&&window.document&&window.document.createElement;var Y=e.i(20783);function V(e,r=[]){let a=[],s=()=>{let t=a.map(e=>p.createContext(e));return function(r){let a=r?.[e]||t;return p.useMemo(()=>({[`__scope${e}`]:{...r,[e]:a}}),[r,a])}};return s.scopeName=e,[function(r,s){let o=p.createContext(s),i=a.length;a=[...a,s];let n=r=>{let{scope:a,children:s,...n}=r,l=a?.[e]?.[i]||o,c=p.useMemo(()=>n,Object.values(n));return(0,t.jsx)(l.Provider,{value:c,children:s})};return n.displayName=r+"Provider",[n,function(t,a){let n=a?.[e]?.[i]||o,l=p.useContext(n);if(l)return l;if(void 0!==s)return s;throw Error(`\`${t}\` must be used within \`${r}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let a=r.reduce((t,{useScope:r,scopeName:a})=>{let s=r(e)[`__scope${a}`];return{...t,...s}},{});return p.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}(s,...r)]}var Z=globalThis?.document?p.useLayoutEffect:()=>{};p[" useEffectEvent ".trim().toString()],p[" useInsertionEffect ".trim().toString()];var K=p[" useInsertionEffect ".trim().toString()]||Z;Symbol("RADIX:SYNC_STATE");var W=p.createContext(void 0),J=e.i(74080),X=Symbol("radix.slottable");function Q(e){return p.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===X}var ee=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{var a,s;let o,i,n,l=(s=a=`Primitive.${r}`,(o=p.forwardRef((e,t)=>{let{children:r,...a}=e;if(p.isValidElement(r)){var s;let e,o,i=(s=r,(o=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.ref:(o=(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.props.ref:s.props.ref||s.ref),n=function(e,t){let r={...t};for(let a in t){let s=e[a],o=t[a];/^on[A-Z]/.test(a)?s&&o?r[a]=(...e)=>{let t=o(...e);return s(...e),t}:s&&(r[a]=s):"style"===a?r[a]={...s,...o}:"className"===a&&(r[a]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==p.Fragment&&(n.ref=t?(0,Y.composeRefs)(t,i):i),p.cloneElement(r,n)}return p.Children.count(r)>1?p.Children.only(null):null})).displayName=`${s}.SlotClone`,i=o,(n=p.forwardRef((e,r)=>{let{children:a,...s}=e,o=p.Children.toArray(a),n=o.find(Q);if(n){let e=n.props.children,a=o.map(t=>t!==n?t:p.Children.count(e)>1?p.Children.only(null):p.isValidElement(e)?e.props.children:null);return(0,t.jsx)(i,{...s,ref:r,children:p.isValidElement(e)?p.cloneElement(e,void 0,a):null})}return(0,t.jsx)(i,{...s,ref:r,children:a})})).displayName=`${a}.Slot`,n),c=p.forwardRef((e,a)=>{let{asChild:s,...o}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(s?l:r,{...o,ref:a})});return c.displayName=`Primitive.${r}`,{...e,[r]:c}},{});function et(e){var r;let a,s=(r=e,(a=p.forwardRef((e,t)=>{let{children:r,...a}=e;if(p.isValidElement(r)){var s;let e,o,i=(s=r,(o=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.ref:(o=(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.props.ref:s.props.ref||s.ref),n=function(e,t){let r={...t};for(let a in t){let s=e[a],o=t[a];/^on[A-Z]/.test(a)?s&&o?r[a]=(...e)=>{let t=o(...e);return s(...e),t}:s&&(r[a]=s):"style"===a?r[a]={...s,...o}:"className"===a&&(r[a]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==p.Fragment&&(n.ref=t?(0,Y.composeRefs)(t,i):i),p.cloneElement(r,n)}return p.Children.count(r)>1?p.Children.only(null):null})).displayName=`${r}.SlotClone`,a),o=p.forwardRef((e,r)=>{let{children:a,...o}=e,i=p.Children.toArray(a),n=i.find(ea);if(n){let e=n.props.children,a=i.map(t=>t!==n?t:p.Children.count(e)>1?p.Children.only(null):p.isValidElement(e)?e.props.children:null);return(0,t.jsx)(s,{...o,ref:r,children:p.isValidElement(e)?p.cloneElement(e,void 0,a):null})}return(0,t.jsx)(s,{...o,ref:r,children:a})});return o.displayName=`${e}.Slot`,o}var er=Symbol("radix.slottable");function ea(e){return p.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===er}var es=new WeakMap;function eo(e,t){var r,a;let s,o,i;if("at"in Array.prototype)return Array.prototype.at.call(e,t);let n=(r=e,a=t,s=r.length,(i=(o=ei(a))>=0?o:s+o)<0||i>=s?-1:i);return -1===n?void 0:e[n]}function ei(e){return e!=e||0===e?0:Math.trunc(e)}(class e extends Map{#e;constructor(e){super(e),this.#e=[...super.keys()],es.set(this,!0)}set(e,t){return es.get(this)&&(this.has(e)?this.#e[this.#e.indexOf(e)]=e:this.#e.push(e)),super.set(e,t),this}insert(e,t,r){let a,s=this.has(t),o=this.#e.length,i=ei(e),n=i>=0?i:o+i,l=n<0||n>=o?-1:n;if(l===this.size||s&&l===this.size-1||-1===l)return this.set(t,r),this;let c=this.size+ +!s;i<0&&n++;let d=[...this.#e],u=!1;for(let e=n;e<c;e++)if(n===e){let o=d[e];d[e]===t&&(o=d[e+1]),s&&this.delete(t),a=this.get(o),this.set(t,r)}else{u||d[e-1]!==t||(u=!0);let r=d[u?e:e-1],s=a;a=this.get(r),this.delete(r),this.set(r,s)}return this}with(t,r,a){let s=new e(this);return s.insert(t,r,a),s}before(e){let t=this.#e.indexOf(e)-1;if(!(t<0))return this.entryAt(t)}setBefore(e,t,r){let a=this.#e.indexOf(e);return -1===a?this:this.insert(a,t,r)}after(e){let t=this.#e.indexOf(e);if(-1!==(t=-1===t||t===this.size-1?-1:t+1))return this.entryAt(t)}setAfter(e,t,r){let a=this.#e.indexOf(e);return -1===a?this:this.insert(a+1,t,r)}first(){return this.entryAt(0)}last(){return this.entryAt(-1)}clear(){return this.#e=[],super.clear()}delete(e){let t=super.delete(e);return t&&this.#e.splice(this.#e.indexOf(e),1),t}deleteAt(e){let t=this.keyAt(e);return void 0!==t&&this.delete(t)}at(e){let t=eo(this.#e,e);if(void 0!==t)return this.get(t)}entryAt(e){let t=eo(this.#e,e);if(void 0!==t)return[t,this.get(t)]}indexOf(e){return this.#e.indexOf(e)}keyAt(e){return eo(this.#e,e)}from(e,t){let r=this.indexOf(e);if(-1===r)return;let a=r+t;return a<0&&(a=0),a>=this.size&&(a=this.size-1),this.at(a)}keyFrom(e,t){let r=this.indexOf(e);if(-1===r)return;let a=r+t;return a<0&&(a=0),a>=this.size&&(a=this.size-1),this.keyAt(a)}find(e,t){let r=0;for(let a of this){if(Reflect.apply(e,t,[a,r,this]))return a;r++}}findIndex(e,t){let r=0;for(let a of this){if(Reflect.apply(e,t,[a,r,this]))return r;r++}return -1}filter(t,r){let a=[],s=0;for(let e of this)Reflect.apply(t,r,[e,s,this])&&a.push(e),s++;return new e(a)}map(t,r){let a=[],s=0;for(let e of this)a.push([e[0],Reflect.apply(t,r,[e,s,this])]),s++;return new e(a)}reduce(...e){let[t,r]=e,a=0,s=r??this.at(0);for(let r of this)s=0===a&&1===e.length?r:Reflect.apply(t,this,[s,r,a,this]),a++;return s}reduceRight(...e){let[t,r]=e,a=r??this.at(-1);for(let r=this.size-1;r>=0;r--){let s=this.at(r);a=r===this.size-1&&1===e.length?s:Reflect.apply(t,this,[a,s,r,this])}return a}toSorted(t){return new e([...this.entries()].sort(t))}toReversed(){let t=new e;for(let e=this.size-1;e>=0;e--){let r=this.keyAt(e),a=this.get(r);t.set(r,a)}return t}toSpliced(...t){let r=[...this.entries()];return r.splice(...t),new e(r)}slice(t,r){let a=new e,s=this.size-1;if(void 0===t)return a;t<0&&(t+=this.size),void 0!==r&&r>0&&(s=r-1);for(let e=t;e<=s;e++){let t=this.keyAt(e),r=this.get(t);a.set(t,r)}return a}every(e,t){let r=0;for(let a of this){if(!Reflect.apply(e,t,[a,r,this]))return!1;r++}return!0}some(e,t){let r=0;for(let a of this){if(Reflect.apply(e,t,[a,r,this]))return!0;r++}return!1}});var en=["PageUp","PageDown"],el=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ec={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ed="Slider",[eu,em,ep]=function(e){let r=e+"CollectionProvider",[a,s]=V(r),[o,i]=a(r,{collectionRef:{current:null},itemMap:new Map}),n=e=>{let{scope:r,children:a}=e,s=p.default.useRef(null),i=p.default.useRef(new Map).current;return(0,t.jsx)(o,{scope:r,itemMap:i,collectionRef:s,children:a})};n.displayName=r;let l=e+"CollectionSlot",c=et(l),d=p.default.forwardRef((e,r)=>{let{scope:a,children:s}=e,o=i(l,a),n=(0,Y.useComposedRefs)(r,o.collectionRef);return(0,t.jsx)(c,{ref:n,children:s})});d.displayName=l;let u=e+"CollectionItemSlot",m="data-radix-collection-item",h=et(u),f=p.default.forwardRef((e,r)=>{let{scope:a,children:s,...o}=e,n=p.default.useRef(null),l=(0,Y.useComposedRefs)(r,n),c=i(u,a);return p.default.useEffect(()=>(c.itemMap.set(n,{ref:n,...o}),()=>void c.itemMap.delete(n))),(0,t.jsx)(h,{...{[m]:""},ref:l,children:s})});return f.displayName=u,[{Provider:n,Slot:d,ItemSlot:f},function(t){let r=i(e+"CollectionConsumer",t);return p.default.useCallback(()=>{let e=r.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${m}]`));return Array.from(r.itemMap.values()).sort((e,r)=>t.indexOf(e.ref.current)-t.indexOf(r.ref.current))},[r.collectionRef,r.itemMap])},s]}(ed),[eh,ef]=V(ed,[ep]),[ex,eg]=eh(ed),ey=p.forwardRef((e,r)=>{let{name:a,min:s=0,max:o=100,step:i=1,orientation:n="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:d=[s],value:u,onValueChange:m=()=>{},onValueCommit:h=()=>{},inverted:f=!1,form:x,...g}=e,y=p.useRef(new Set),v=p.useRef(0),j="horizontal"===n,[b=[],w]=function({prop:e,defaultProp:t,onChange:r=()=>{},caller:a}){let[s,o,i]=function({defaultProp:e,onChange:t}){let[r,a]=p.useState(e),s=p.useRef(r),o=p.useRef(t);return K(()=>{o.current=t},[t]),p.useEffect(()=>{s.current!==r&&(o.current?.(r),s.current=r)},[r,s]),[r,a,o]}({defaultProp:t,onChange:r}),n=void 0!==e,l=n?e:s;{let t=p.useRef(void 0!==e);p.useEffect(()=>{let e=t.current;if(e!==n){let t=n?"controlled":"uncontrolled";console.warn(`${a} is changing from ${e?"controlled":"uncontrolled"} to ${t}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=n},[n,a])}return[l,p.useCallback(t=>{if(n){let r="function"==typeof t?t(e):t;r!==e&&i.current?.(r)}else o(t)},[n,e,o,i])]}({prop:u,defaultProp:d,onChange:e=>{let t=[...y.current];t[v.current]?.focus(),m(e)}}),k=p.useRef(b);function N(e,t,{commit:r}={commit:!1}){let a,n=(String(i).split(".")[1]||"").length,l=q(Math.round((Math.round((e-s)/i)*i+s)*(a=Math.pow(10,n)))/a,[s,o]);w((e=[])=>{let a=function(e=[],t,r){let a=[...e];return a[r]=t,a.sort((e,t)=>e-t)}(e,l,t);if(!function(e,t){if(t>0)return Math.min(...e.slice(0,-1).map((t,r)=>e[r+1]-t))>=t;return!0}(a,c*i))return e;{v.current=a.indexOf(l);let t=String(a)!==String(e);return t&&r&&h(a),t?a:e}})}return(0,t.jsx)(ex,{scope:e.__scopeSlider,name:a,disabled:l,min:s,max:o,valueIndexToChangeRef:v,thumbs:y.current,values:b,orientation:n,form:x,children:(0,t.jsx)(eu.Provider,{scope:e.__scopeSlider,children:(0,t.jsx)(eu.Slot,{scope:e.__scopeSlider,children:(0,t.jsx)(j?eb:ew,{"aria-disabled":l,"data-disabled":l?"":void 0,...g,ref:r,onPointerDown:G(g.onPointerDown,()=>{l||(k.current=b)}),min:s,max:o,inverted:f,onSlideStart:l?void 0:function(e){let t=function(e,t){if(1===e.length)return 0;let r=e.map(e=>Math.abs(e-t)),a=Math.min(...r);return r.indexOf(a)}(b,e);N(e,t)},onSlideMove:l?void 0:function(e){N(e,v.current)},onSlideEnd:l?void 0:function(){let e=k.current[v.current];b[v.current]!==e&&h(b)},onHomeKeyDown:()=>!l&&N(s,0,{commit:!0}),onEndKeyDown:()=>!l&&N(o,b.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!l){let r=en.includes(e.key)||e.shiftKey&&el.includes(e.key),a=v.current;N(b[a]+i*(r?10:1)*t,a,{commit:!0})}}})})})})});ey.displayName=ed;var[ev,ej]=eh(ed,{startEdge:"left",endEdge:"right",size:"width",direction:1}),eb=p.forwardRef((e,r)=>{let a,{min:s,max:o,dir:i,inverted:n,onSlideStart:l,onSlideMove:c,onSlideEnd:d,onStepKeyDown:u,...m}=e,[h,f]=p.useState(null),x=(0,Y.useComposedRefs)(r,e=>f(e)),g=p.useRef(void 0),y=(a=p.useContext(W),i||a||"ltr"),v="ltr"===y,j=v&&!n||!v&&n;function b(e){let t=g.current||h.getBoundingClientRect(),r=eT([0,t.width],j?[s,o]:[o,s]);return g.current=t,r(e-t.left)}return(0,t.jsx)(ev,{scope:e.__scopeSlider,startEdge:j?"left":"right",endEdge:j?"right":"left",direction:j?1:-1,size:"width",children:(0,t.jsx)(ek,{dir:y,"data-orientation":"horizontal",...m,ref:x,style:{...m.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=b(e.clientX);l?.(t)},onSlideMove:e=>{let t=b(e.clientX);c?.(t)},onSlideEnd:()=>{g.current=void 0,d?.()},onStepKeyDown:e=>{let t=ec[j?"from-left":"from-right"].includes(e.key);u?.({event:e,direction:t?-1:1})}})})}),ew=p.forwardRef((e,r)=>{let{min:a,max:s,inverted:o,onSlideStart:i,onSlideMove:n,onSlideEnd:l,onStepKeyDown:c,...d}=e,u=p.useRef(null),m=(0,Y.useComposedRefs)(r,u),h=p.useRef(void 0),f=!o;function x(e){let t=h.current||u.current.getBoundingClientRect(),r=eT([0,t.height],f?[s,a]:[a,s]);return h.current=t,r(e-t.top)}return(0,t.jsx)(ev,{scope:e.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:(0,t.jsx)(ek,{"data-orientation":"vertical",...d,ref:m,style:{...d.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=x(e.clientY);i?.(t)},onSlideMove:e=>{let t=x(e.clientY);n?.(t)},onSlideEnd:()=>{h.current=void 0,l?.()},onStepKeyDown:e=>{let t=ec[f?"from-bottom":"from-top"].includes(e.key);c?.({event:e,direction:t?-1:1})}})})}),ek=p.forwardRef((e,r)=>{let{__scopeSlider:a,onSlideStart:s,onSlideMove:o,onSlideEnd:i,onHomeKeyDown:n,onEndKeyDown:l,onStepKeyDown:c,...d}=e,u=eg(ed,a);return(0,t.jsx)(ee.span,{...d,ref:r,onKeyDown:G(e.onKeyDown,e=>{"Home"===e.key?(n(e),e.preventDefault()):"End"===e.key?(l(e),e.preventDefault()):en.concat(el).includes(e.key)&&(c(e),e.preventDefault())}),onPointerDown:G(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():s(e)}),onPointerMove:G(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&o(e)}),onPointerUp:G(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),i(e))})})}),eN="SliderTrack",eI=p.forwardRef((e,r)=>{let{__scopeSlider:a,...s}=e,o=eg(eN,a);return(0,t.jsx)(ee.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...s,ref:r})});eI.displayName=eN;var eS="SliderRange",eC=p.forwardRef((e,r)=>{let{__scopeSlider:a,...s}=e,o=eg(eS,a),i=ej(eS,a),n=p.useRef(null),l=(0,Y.useComposedRefs)(r,n),c=o.values.length,d=o.values.map(e=>ez(e,o.min,o.max)),u=c>1?Math.min(...d):0,m=100-Math.max(...d);return(0,t.jsx)(ee.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...s,ref:l,style:{...e.style,[i.startEdge]:u+"%",[i.endEdge]:m+"%"}})});eC.displayName=eS;var eP="SliderThumb",e$=p.forwardRef((e,r)=>{let a=em(e.__scopeSlider),[s,o]=p.useState(null),i=(0,Y.useComposedRefs)(r,e=>o(e)),n=p.useMemo(()=>s?a().findIndex(e=>e.ref.current===s):-1,[a,s]);return(0,t.jsx)(eM,{...e,ref:i,index:n})}),eM=p.forwardRef((e,r)=>{var a,s,o,i,n;let l,c,{__scopeSlider:d,index:u,name:m,...h}=e,f=eg(eP,d),x=ej(eP,d),[g,y]=p.useState(null),v=(0,Y.useComposedRefs)(r,e=>y(e)),j=!g||f.form||!!g.closest("form"),b=function(e){let[t,r]=p.useState(void 0);return Z(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let a,s;if(!Array.isArray(t)||!t.length)return;let o=t[0];if("borderBoxSize"in o){let e=o.borderBoxSize,t=Array.isArray(e)?e[0]:e;a=t.inlineSize,s=t.blockSize}else a=e.offsetWidth,s=e.offsetHeight;r({width:a,height:s})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}(g),w=f.values[u],k=void 0===w?0:ez(w,f.min,f.max),N=(a=u,(s=f.values.length)>2?`Value ${a+1} of ${s}`:2===s?["Minimum","Maximum"][a]:void 0),I=b?.[x.size],S=I?(o=I,i=k,n=x.direction,c=eT([0,50],[0,l=o/2]),(l-c(i)*n)*n):0;return p.useEffect(()=>{if(g)return f.thumbs.add(g),()=>{f.thumbs.delete(g)}},[g,f.thumbs]),(0,t.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[x.startEdge]:`calc(${k}% + ${S}px)`},children:[(0,t.jsx)(eu.ItemSlot,{scope:e.__scopeSlider,children:(0,t.jsx)(ee.span,{role:"slider","aria-label":e["aria-label"]||N,"aria-valuemin":f.min,"aria-valuenow":w,"aria-valuemax":f.max,"aria-orientation":f.orientation,"data-orientation":f.orientation,"data-disabled":f.disabled?"":void 0,tabIndex:f.disabled?void 0:0,...h,ref:v,style:void 0===w?{display:"none"}:e.style,onFocus:G(e.onFocus,()=>{f.valueIndexToChangeRef.current=u})})}),j&&(0,t.jsx)(eA,{name:m??(f.name?f.name+(f.values.length>1?"[]":""):void 0),form:f.form,value:w},u)]})});e$.displayName=eP;var eA=p.forwardRef(({__scopeSlider:e,value:r,...a},s)=>{let o,i=p.useRef(null),n=(0,Y.useComposedRefs)(i,s),l=(o=p.useRef({value:r,previous:r}),p.useMemo(()=>(o.current.value!==r&&(o.current.previous=o.current.value,o.current.value=r),o.current.previous),[r]));return p.useEffect(()=>{let e=i.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;if(l!==r&&t){let a=new Event("input",{bubbles:!0});t.call(e,r),e.dispatchEvent(a)}},[l,r]),(0,t.jsx)(ee.input,{style:{display:"none"},...a,ref:n,defaultValue:r})});function ez(e,t,r){return q(100/(r-t)*(e-t),[0,100])}function eT(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let a=(t[1]-t[0])/(e[1]-e[0]);return t[0]+a*(r-e[0])}}eA.displayName="RadioBubbleInput";let eE=p.forwardRef(({className:e,...r},a)=>(0,t.jsxs)(ey,{ref:a,className:(0,u.cn)("relative flex w-full touch-none select-none items-center",e),...r,children:[(0,t.jsx)(eI,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,t.jsx)(eC,{className:"absolute h-full bg-primary"})}),(0,t.jsx)(e$,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));eE.displayName=ey.displayName;let eR=(0,o.default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),eF=(0,o.default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),eO=(0,o.default)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var e_=e.i(88653);function eB({selectedZoneIds:e,onZoneToggle:a,onGroupZones:o,onUngroupZones:i,compact:n=!1}){let{groups:d,currentGroup:h}=(0,r.useSonos)(),[f,x]=(0,p.useState)(!1),[g,y]=(0,p.useState)(""),v=(0,p.useMemo)(()=>{if(!g.trim())return d;let e=g.toLowerCase();return d.filter(t=>t.name.toLowerCase().includes(e))},[d,g]),j=e.length>1,b=j&&e.length>0,w=e.length===d.length&&d.length>0;return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)(s.Button,{variant:"ghost",onClick:()=>x(!f),className:(0,u.cn)("flex items-center gap-2 transition-all text-foreground hover:bg-foreground/10",n?"h-10 px-3 text-xs":"h-12 px-4"),children:[(0,t.jsx)(l.Waves,{className:"h-4 w-4 text-foreground opacity-90"}),(0,t.jsx)("span",{className:"font-black uppercase tracking-tight text-foreground opacity-90",children:0===e.length?"Select Zones":`${e.length} Zone${e.length>1?"s":""}`})]}),(0,J.createPortal)((0,t.jsx)(e_.AnimatePresence,{children:f&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-[300] bg-black/70 backdrop-blur-md",onClick:()=>x(!1)}),(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:n?20:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:n?20:-20,scale:.95},transition:{duration:.2},className:(0,u.cn)("fixed z-[301] bg-background backdrop-blur-2xl rounded-2xl border-2 border-foreground/20 shadow-2xl overflow-hidden flex flex-col",n?"bottom-[200px] right-4 sm:right-12 lg:right-20 w-[360px] max-w-[calc(100vw-2rem)]":"top-20 right-4 sm:right-6 md:right-8 w-[420px] max-w-[calc(100vw-2rem)]"),children:[(0,t.jsxs)("div",{className:"p-5 pb-4 border-b border-foreground/10 shrink-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h3",{className:"text-sm font-black uppercase tracking-[0.15em] text-foreground",children:"SELECT ZONES"}),e.length>0&&(0,t.jsx)(m.motion.div,{initial:{scale:0},animate:{scale:1},className:"h-7 w-7 rounded-full bg-primary flex items-center justify-center shadow-md",children:(0,t.jsx)("span",{className:"text-xs font-black text-primary-foreground",children:e.length})})]}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-10 w-10 text-foreground hover:bg-foreground/10 active:scale-95 transition-all rounded-xl",onClick:()=>x(!1),children:(0,t.jsx)(eR,{className:"h-5 w-5"})})]}),(0,t.jsxs)("div",{className:"relative mb-4",children:[(0,t.jsx)(eF,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground pointer-events-none"}),(0,t.jsx)("input",{type:"text",placeholder:"Search zones...",value:g,onChange:e=>y(e.target.value),className:"w-full pl-12 pr-4 py-3.5 bg-foreground/5 border-2 border-foreground/10 rounded-2xl text-base font-medium text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary/40 transition-all touch-manipulation"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(s.Button,{variant:"ghost",onClick:()=>{w?e.forEach(e=>a(e)):v.forEach(t=>{e.includes(t.id)||a(t.id)})},className:"h-11 px-4 text-xs font-black uppercase tracking-wider text-foreground/80 hover:text-foreground hover:bg-foreground/10 active:scale-95 transition-all rounded-xl touch-manipulation",children:[(0,t.jsx)(eO,{className:"h-4 w-4 mr-2"}),w?"Deselect All":"Select All"]}),v.length!==d.length&&(0,t.jsxs)("span",{className:"text-xs font-black uppercase tracking-wider text-muted-foreground px-3 py-2 bg-foreground/5 rounded-xl",children:[v.length," of ",d.length]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto no-scrollbar p-4 pb-5",children:0===v.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)(l.Waves,{className:"h-12 w-12 text-muted-foreground opacity-20 mb-3"}),(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"No zones found"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground opacity-70 mt-1",children:"Try a different search term"})]}):(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:v.map((r,s)=>{let o=e.includes(r.id),i="PLAYBACK_STATE_PLAYING"===r.playbackState,n=h?.id===r.id;return(0,t.jsxs)(m.motion.button,{onClick:()=>a(r.id),initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.02*s},className:(0,u.cn)("relative flex flex-col items-center justify-center p-5 rounded-2xl transition-all border-2 min-h-[120px] touch-manipulation",o?"bg-foreground text-background border-foreground shadow-lg":"bg-foreground/[0.03] border-transparent active:bg-foreground/[0.08] active:border-foreground/20 dark:active:bg-foreground/[0.12]"),whileHover:{scale:1.02},whileTap:{scale:.95},children:[o&&(0,t.jsx)(m.motion.div,{initial:{scale:0},animate:{scale:1},className:"absolute top-3 right-3 h-7 w-7 rounded-full bg-background flex items-center justify-center shadow-lg",children:(0,t.jsx)(c.Check,{className:"h-4 w-4 text-foreground"})}),(0,t.jsx)("div",{className:(0,u.cn)("h-14 w-14 rounded-full flex items-center justify-center mb-3 transition-all",o?"bg-background/20":"bg-foreground/[0.08] dark:bg-foreground/[0.12]"),children:(0,t.jsx)(l.Waves,{className:(0,u.cn)("h-7 w-7",o?"text-background":"text-foreground opacity-70")})}),(0,t.jsx)("span",{className:(0,u.cn)("text-sm font-black uppercase tracking-tight text-center leading-tight line-clamp-2",o?"text-background":"text-foreground opacity-90"),children:r.name}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mt-2",children:[i&&(0,t.jsx)(m.motion.div,{animate:{opacity:[.5,1,.5]},transition:{repeat:1/0,duration:1.5},className:"h-1.5 w-1.5 rounded-full bg-primary"}),n&&(0,t.jsx)("span",{className:"text-[8px] font-black uppercase tracking-[0.1em] text-primary opacity-80",children:"Active"})]})]},r.id)})})}),b&&(0,t.jsx)("div",{className:"p-5 pt-4 border-t border-foreground/10 shrink-0",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(s.Button,{variant:"default",onClick:()=>{o(),x(!1)},className:"flex-1 h-12 text-sm font-black uppercase bg-foreground text-background hover:bg-foreground/90 active:scale-95 transition-all rounded-xl touch-manipulation",children:["Group ",e.length," Zones"]}),j&&(0,t.jsx)(s.Button,{variant:"ghost",onClick:()=>{i(),x(!1)},className:"h-12 px-5 text-sm font-black uppercase text-foreground hover:bg-foreground/10 active:scale-95 transition-all rounded-xl touch-manipulation",children:"Split"})]})})]})]})}),document.body)]})}let eD=(0,o.default)("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),eL=(0,o.default)("volume-x",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),eU=(0,o.default)("volume-1",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}]]),eH=(0,o.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),eq=(0,o.default)("split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]),eG=(0,o.default)("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);function eY({selectedZoneIds:e,compact:a=!1}){let{groups:o,refreshState:i,setCurrentGroup:n,setSelectedZoneIds:l,volume:c}=(0,r.useSonos)(),[d,h]=(0,p.useState)(!1),[f,x]=(0,p.useState)({}),[g,y]=(0,p.useState)(!1),[j,b]=(0,p.useState)(null),[w,k]=(0,p.useState)([]);(0,p.useEffect)(()=>{d&&e.length>0&&N()},[d,e,c]);let N=async()=>{y(!0);try{let t=o.filter(t=>e.includes(t.id)),r=[];try{let e=await fetch("/api/sonos/players");e.ok&&(r=(await e.json()).players||[],console.log("Fetched all players:",r))}catch(e){console.error("Failed to fetch all players:",e)}let a=t.map(async e=>{console.log("Processing group for volume:",e);let t=null;try{let r=await fetch(`/api/sonos/volume?groupId=${e.id}`);if(r.ok){let a=await r.json();t="number"==typeof a.volume?a.volume:null,console.log(`Fetched volume for group ${e.id}: ${t}`)}else{let t=await r.text();console.warn(`Failed to fetch volume for ${e.id}: ${r.status} - ${t}`)}}catch(t){console.error(`Failed to fetch group volume for ${e.id}:`,t)}let a=t??c??50,s=(e=>{let t=[],r=new Set;if(console.log("Extracting players from group:",e),e.players&&Array.isArray(e.players)&&(console.log("Found group.players array:",e.players),e.players.forEach(e=>{let a=e.id||e.playerId||e.player?.id||e.playerId,s=e.name||e.playerName||e.displayName||`Player ${a?.slice(-4)||"Unknown"}`;console.log("Processing player:",e,"Extracted ID:",a,"Name:",s),a&&!r.has(a)&&(r.add(a),t.push({playerId:a,name:s,volume:50}))})),e.playerIds&&Array.isArray(e.playerIds)&&(console.log("Found group.playerIds array:",e.playerIds),e.playerIds.forEach(e=>{e&&!r.has(e)&&(r.add(e),t.push({playerId:e,name:`Player ${e.slice(-4)}`,volume:50}))})),e.coordinatorId&&!r.has(e.coordinatorId)&&(console.log("Found coordinatorId:",e.coordinatorId),r.add(e.coordinatorId),t.push({playerId:e.coordinatorId,name:e.name||`Player ${e.coordinatorId.slice(-4)}`,volume:50})),0===t.length&&e.id&&e.id.includes(":")){let r=e.id.split(":")[0];console.log("Extracting coordinator from group ID:",r),t.push({playerId:r,name:e.name||`Player ${r.slice(-4)}`,volume:50})}return console.log("Extracted players:",t),t})(e),i=e.name&&(e.name.includes("+")||e.name.includes("&")),n=e.name?.match(/\+ (\d+)/),l=n?parseInt(n[1])+1:i?2:1;console.log(`Group "${e.name}" - Expected ${l} players, found ${s.length}`);let d=e.coordinatorId||(e.id?.includes(":")?e.id.split(":")[0]:e.id);if(e.playerIds&&Array.isArray(e.playerIds)&&e.playerIds.length>0){console.log("Using group.playerIds as source of truth:",e.playerIds);let t=[];e.playerIds.forEach(e=>{let a=r.find(t=>t.id===e||t.coordinatorId===e);if(!a){let t=e.slice(-4);a=r.find(r=>{let a=r.id||r.coordinatorId||"";return a.includes(t)||e.includes(a.slice(-4))})}if(!a){let t=o.find(t=>(t.coordinatorId||(t.id?.includes(":")?t.id.split(":")[0]:t.id))===e&&!t.name?.includes("+")&&!t.name?.includes("&"));t&&(a={id:e,name:t.name,coordinatorId:e})}let s=a?.name||`Player ${e.slice(-4)}`;console.log(`Player ${e} matched to: ${s}`,a),t.push({playerId:e,name:s,volume:50})}),s.length=0,s.push(...t)}else s.forEach(t=>{let a=r.find(e=>e.id===t.playerId||e.coordinatorId===t.playerId);if(!a){let e=t.playerId.slice(-4);a=r.find(r=>{let a=r.id||r.coordinatorId||"";return a.includes(e)||t.playerId.includes(a.slice(-4))})}if(!a){let e=o.find(e=>(e.coordinatorId||(e.id?.includes(":")?e.id.split(":")[0]:e.id))===t.playerId&&!e.name?.includes("+")&&!e.name?.includes("&"));e&&(a={id:t.playerId,name:e.name,coordinatorId:t.playerId})}a?.name&&(t.name.startsWith("Player ")||t.name===e.name||!t.name)&&(t.name=a.name,console.log(`Updated player ${t.playerId} name to: ${a.name}`))});if(s.length<l&&r.length>0){if(s.length<l&&e.name){let t=e.name.split(/[\+\&]/).map(e=>e.trim());r.forEach(e=>{if(s.length>=l)return;let r=e.name||"";t.some(e=>r.toLowerCase().includes(e.toLowerCase())||e.toLowerCase().includes(r.toLowerCase()))&&!s.find(t=>t.playerId===e.id)&&s.push({playerId:e.id,name:e.name||`Player ${e.id.slice(-4)}`,volume:50})})}1===s.length&&d&&o.forEach(t=>{if(t.id===e.id)return;let a=t.coordinatorId||(t.id?.includes(":")?t.id.split(":")[0]:t.id);if(e.playerIds&&e.playerIds.includes(a)){let e=r.find(e=>e.id===a);e&&!s.find(e=>e.playerId===a)&&s.push({playerId:a,name:t.name||e.name||`Player ${a.slice(-4)}`,volume:50})}})}console.log(`Group ${e.name} (${e.id}) has ${s.length} players:`,s);let u=s.map(async e=>{try{console.log(`Fetching volume for player ${e.playerId} (${e.name})`);let t=await fetch(`/api/sonos/player-volume?playerId=${e.playerId}`);if(t.ok){let r=await t.json(),s="number"==typeof r.volume?r.volume:a;return console.log(`Player ${e.playerId} volume: ${s}`),{...e,volume:s}}{let r=await t.text();return console.error(`Failed to fetch volume for player ${e.playerId}:`,t.status,r),{...e,volume:a}}}catch(t){return console.error(`Error fetching volume for player ${e.playerId}:`,t),{...e,volume:a}}}),m=await Promise.all(u);return{groupId:e.id,groupName:e.name,groupVolume:a,players:m,isPlaying:"PLAYBACK_STATE_PLAYING"===e.playbackState,isExpanded:!1}}),s=await Promise.all(a),i={};s.forEach(e=>{i[e.groupId]=e}),x(i)}catch(e){console.error("Failed to fetch volumes:",e)}finally{y(!1)}},I=async(e,t)=>{let r=t[0];x(t=>({...t,[e]:{...t[e],groupVolume:r}}));try{let t=await fetch(`/api/sonos/control?groupId=${e}&volume=${r}`,{method:"POST"});if(410===t.status){await i();try{let t=await fetch(`/api/sonos/volume?groupId=${e}`);if(t.ok){let r=await t.json();x(t=>({...t,[e]:{...t[e],groupVolume:r.volume||50}}))}}catch(e){console.error("Failed to refresh volume after 410:",e)}}else if(!t.ok){let r=await t.text();console.error(`Failed to set group volume: ${t.status} ${r}`);try{let t=await fetch(`/api/sonos/volume?groupId=${e}`);if(t.ok){let r=await t.json();x(t=>({...t,[e]:{...t[e],groupVolume:r.volume||50}}))}}catch(e){console.error("Failed to revert volume:",e)}}}catch(t){console.error(`Failed to set group volume for ${e}:`,t);try{let t=await fetch(`/api/sonos/volume?groupId=${e}`);if(t.ok){let r=await t.json();x(t=>({...t,[e]:{...t[e],groupVolume:r.volume||50}}))}}catch(e){console.error("Failed to revert volume:",e)}}},S=async(e,t,r)=>{let a=r[0];x(r=>({...r,[e]:{...r[e],players:r[e].players.map(e=>e.playerId===t?{...e,volume:a}:e)}}));try{let r=await fetch(`/api/sonos/player-volume?playerId=${t}&volume=${a}`,{method:"POST"});if(410===r.status){await i();try{let r=await fetch(`/api/sonos/player-volume?playerId=${t}`);if(r.ok){let a=await r.json();x(r=>({...r,[e]:{...r[e],players:r[e].players.map(e=>e.playerId===t?{...e,volume:a.volume||50}:e)}}))}}catch(e){console.error("Failed to refresh volume after 410:",e)}}else if(!r.ok){let a=await r.text();console.error(`Failed to set player volume: ${r.status} ${a}`);try{let r=await fetch(`/api/sonos/player-volume?playerId=${t}`);if(r.ok){let a=await r.json();x(r=>({...r,[e]:{...r[e],players:r[e].players.map(e=>e.playerId===t?{...e,volume:a.volume||50}:e)}}))}}catch(e){console.error("Failed to revert volume:",e)}}}catch(r){console.error(`Failed to set player volume for ${t}:`,r);try{let r=await fetch(`/api/sonos/player-volume?playerId=${t}`);if(r.ok){let a=await r.json();x(r=>({...r,[e]:{...r[e],players:r[e].players.map(e=>e.playerId===t?{...e,volume:a.volume||50}:e)}}))}}catch(e){console.error("Failed to revert volume:",e)}}},C=async e=>{let t=o.find(t=>t.id===e);if(!t)return;let r=t.coordinatorId||(t.id?.includes(":")?t.id.split(":")[0]:t.id);try{let t=await fetch("/api/sonos/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:e,playerIds:[r]})});if(!t.ok){let e=await t.json().catch(()=>({error:"Failed to parse error response"}));console.error("Split group error:",e),alert(`Failed to split group: ${e.error||e.details||"Unknown error"}`);return}await i(),await N()}catch(e){console.error("Failed to split group:",e),alert(`Failed to split group: ${e.message||"Unknown error"}`)}},P=async()=>{if(j)try{let e=await fetch("/api/sonos/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:j,playerIds:w})});if(!e.ok){let t=await e.json().catch(()=>({error:"Failed to parse error response"}));console.error("Edit group error:",t),alert(`Failed to update group: ${t.error||t.details||"Unknown error"}`);return}await i(),await N(),b(null),k([])}catch(e){console.error("Failed to edit group:",e),alert(`Failed to edit group: ${e.message||"Unknown error"}`)}},$=()=>{b(null),k([])},M=e=>0===e?eL:e<50?eU:eD,A=e=>0===e?"Muted":`${Math.round(e)}%`,z=o.filter(t=>e.includes(t.id)),T=z.length>0?Math.round(z.reduce((e,t)=>{let r=f[t.id];return e+(r?.groupVolume??c??50)},0)/z.length):c??50;return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)(s.Button,{variant:"ghost",onClick:()=>h(!d),className:(0,u.cn)("flex items-center gap-2 transition-all text-foreground hover:bg-foreground/10",a?"h-10 px-3 text-xs":"h-12 px-4"),children:[(0,t.jsx)(eD,{className:"h-4 w-4 text-foreground opacity-90"}),(0,t.jsxs)("span",{className:"font-black uppercase tracking-tight text-foreground opacity-90",children:[T,"%"]})]}),(0,J.createPortal)((0,t.jsx)(e_.AnimatePresence,{children:d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-[300] bg-black/70 backdrop-blur-md",onClick:()=>h(!1)}),(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:a?20:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:a?20:-20,scale:.95},transition:{duration:.2},className:(0,u.cn)("fixed z-[301] bg-background backdrop-blur-2xl rounded-3xl border-2 border-foreground/20 shadow-2xl overflow-hidden flex flex-col",a?"bottom-[200px] right-4 sm:right-12 lg:right-20 w-[440px] max-w-[calc(100vw-2rem)] max-h-[75vh]":"bottom-24 right-4 sm:right-6 md:right-8 w-[520px] max-w-[calc(100vw-2rem)] max-h-[80vh]"),children:[(0,t.jsx)("div",{className:"p-6 pb-4 border-b border-foreground/10 shrink-0",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h3",{className:"text-sm font-black uppercase tracking-[0.2em] text-foreground",children:"VOLUME CONTROL"}),e.length>0&&(0,t.jsx)(m.motion.div,{initial:{scale:0},animate:{scale:1},className:"h-8 w-8 rounded-full bg-primary flex items-center justify-center shadow-md",children:(0,t.jsx)("span",{className:"text-xs font-black text-primary-foreground",children:e.length})})]}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-12 w-12 text-foreground hover:bg-foreground/10 active:scale-95 transition-all rounded-xl touch-manipulation",onClick:()=>h(!1),children:(0,t.jsx)(eR,{className:"h-5 w-5"})})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto no-scrollbar p-6 pb-6",children:g?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,t.jsx)(eD,{className:"h-16 w-16 text-muted-foreground opacity-20 mb-4 animate-pulse"}),(0,t.jsx)("p",{className:"text-base font-medium text-muted-foreground",children:"Loading volumes..."})]}):0===z.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,t.jsx)(eD,{className:"h-16 w-16 text-muted-foreground opacity-20 mb-4"}),(0,t.jsx)("p",{className:"text-base font-medium text-muted-foreground",children:"No zones selected"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground opacity-70 mt-2",children:"Select zones to control volume"})]}):(0,t.jsx)("div",{className:"space-y-5",children:z.map((e,r)=>{let a=f[e.id];if(!a)return null;let{groupVolume:i,players:n,isPlaying:l,isExpanded:c}=a,d=M(i),p=n.length>0;return(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*r},className:"space-y-4 p-5 rounded-2xl bg-foreground/[0.03] border border-foreground/10 dark:bg-foreground/[0.05]",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[p&&n.length>1&&(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-11 w-11 shrink-0 text-foreground hover:bg-foreground/10 active:scale-95 transition-all rounded-xl touch-manipulation",onClick:()=>{var t;return t=e.id,void x(e=>({...e,[t]:{...e[t],isExpanded:!e[t].isExpanded}}))},children:c?(0,t.jsx)(eH,{className:"h-5 w-5"}):(0,t.jsx)(v,{className:"h-5 w-5"})}),p&&1===n.length&&(0,t.jsx)("div",{className:"h-11 w-11 shrink-0"}),(0,t.jsx)("div",{className:(0,u.cn)("h-12 w-12 rounded-full flex items-center justify-center transition-all shrink-0",l?"bg-primary/20":"bg-foreground/[0.08] dark:bg-foreground/[0.12]"),children:(0,t.jsx)(d,{className:(0,u.cn)("h-6 w-6",l?"text-primary":"text-foreground opacity-70")})}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0 flex-1 gap-1",children:[(0,t.jsx)("span",{className:"text-sm font-black uppercase tracking-tight text-foreground truncate leading-tight",children:a.groupName}),(0,t.jsxs)("span",{className:"text-xs font-medium text-muted-foreground opacity-70 leading-tight",children:["Group: ",A(i),p&&`  ${n.length} speaker${n.length>1?"s":""}`]})]})]}),l&&(0,t.jsx)(m.motion.div,{animate:{opacity:[.5,1,.5]},transition:{repeat:1/0,duration:1.5},className:"h-2.5 w-2.5 rounded-full bg-primary shrink-0"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 px-2",children:[(0,t.jsx)(eL,{className:(0,u.cn)("h-6 w-6 shrink-0 transition-colors touch-manipulation",0===i?"text-foreground":"text-muted-foreground opacity-50")}),(0,t.jsx)(eE,{value:[i],onValueChange:t=>I(e.id,t),max:100,step:1,className:"flex-1 h-2.5 cursor-pointer touch-manipulation"}),(0,t.jsx)(eD,{className:(0,u.cn)("h-6 w-6 shrink-0 transition-colors touch-manipulation",i>0?"text-foreground":"text-muted-foreground opacity-50")})]}),p&&n.length>1&&(0,t.jsxs)("div",{className:"flex items-center gap-2 pt-2 border-t border-foreground/10",children:[(0,t.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>C(e.id),className:"h-10 px-4 text-xs font-black uppercase tracking-tight text-foreground hover:bg-foreground/10 active:scale-95 transition-all rounded-xl touch-manipulation flex items-center gap-2",children:[(0,t.jsx)(eq,{className:"h-4 w-4"}),"Split"]}),(0,t.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>{var t;let r;(r=f[t=e.id])&&(k(r.players.map(e=>e.playerId)),b(t))},className:"h-10 px-4 text-xs font-black uppercase tracking-tight text-foreground hover:bg-foreground/10 active:scale-95 transition-all rounded-xl touch-manipulation flex items-center gap-2",children:[(0,t.jsx)(eG,{className:"h-4 w-4"}),"Edit Group"]})]})]}),p&&n.length>1&&(0,t.jsx)(e_.AnimatePresence,{children:c&&(0,t.jsx)(m.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"space-y-4 pt-4 border-t border-foreground/10 overflow-hidden",children:n.map((r,a)=>{let s=M(r.volume);return(0,t.jsxs)(m.motion.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.03*a},className:"space-y-3 pl-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,t.jsx)(s,{className:"h-5 w-5 shrink-0 text-muted-foreground opacity-70"}),(0,t.jsx)("span",{className:"text-xs font-bold uppercase tracking-tight text-foreground opacity-90 truncate",children:r.name})]}),(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground opacity-70 shrink-0",children:A(r.volume)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 px-2",children:[(0,t.jsx)(eL,{className:(0,u.cn)("h-5 w-5 shrink-0 transition-colors touch-manipulation",0===r.volume?"text-foreground":"text-muted-foreground opacity-50")}),(0,t.jsx)(eE,{value:[r.volume],onValueChange:t=>S(e.id,r.playerId,t),max:100,step:1,className:"flex-1 h-2 cursor-pointer touch-manipulation"}),(0,t.jsx)(eD,{className:(0,u.cn)("h-5 w-5 shrink-0 transition-colors touch-manipulation",r.volume>0?"text-foreground":"text-muted-foreground opacity-50")})]})]},r.playerId)})})}),j===e.id&&(0,t.jsxs)(m.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"pt-4 border-t border-foreground/10 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h4",{className:"text-xs font-black uppercase tracking-tight text-foreground",children:"Select Zones to Add"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:$,className:"h-9 px-3 text-xs font-black uppercase tracking-tight text-muted-foreground hover:text-foreground hover:bg-foreground/10 active:scale-95 transition-all rounded-xl touch-manipulation",children:"Cancel"}),(0,t.jsxs)(s.Button,{variant:"default",size:"sm",onClick:P,disabled:0===w.length,className:"h-9 px-4 text-xs font-black uppercase tracking-tight bg-foreground text-background hover:bg-foreground/90 active:scale-95 transition-all rounded-xl touch-manipulation disabled:opacity-50 disabled:cursor-not-allowed",children:["Save (",w.length,")"]})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-[200px] overflow-y-auto no-scrollbar",children:o.map(r=>{let a=r.coordinatorId||(r.id?.includes(":")?r.id.split(":")[0]:r.id),s=w.includes(a),o=r.id===e.id,i=f[e.id];return i?.players.some(e=>e.playerId===a),(0,t.jsx)(m.motion.button,{onClick:()=>{k(e=>e.includes(a)?1===e.length?e:e.filter(e=>e!==a):[...e,a])},disabled:o&&1===w.length,className:(0,u.cn)("p-3 rounded-xl border-2 transition-all touch-manipulation text-left",s?"bg-foreground text-background border-foreground":"bg-foreground/[0.03] border-transparent hover:bg-foreground/[0.08]",o&&1===w.length?"opacity-50 cursor-not-allowed":"active:scale-95"),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,t.jsx)("div",{className:"h-5 w-5 rounded-full bg-background flex items-center justify-center shrink-0",children:(0,t.jsx)("div",{className:"h-2.5 w-2.5 rounded-full bg-foreground"})}),(0,t.jsx)("span",{className:(0,u.cn)("text-xs font-bold uppercase tracking-tight truncate",s?"text-background":"text-foreground"),children:r.name})]})},r.id)})})]})]},e.id)})})})]})]})}),document.body)]})}function eV(e){let t=Math.floor(e/1e3),r=Math.floor(t/60);return`${r}:${(t%60).toString().padStart(2,"0")}`}function eZ({onClose:e}){let{currentGroup:a,playbackState:o,volume:i,setVolume:n,refreshState:l,setIsExpanded:c,groups:d,selectedZoneIds:h,toggleZone:f,setCurrentGroup:g,setSelectedZoneIds:y}=(0,r.useSonos)(),[v,j]=(0,p.useState)(0),[w,k]=(0,p.useState)(!1),[N,S]=(0,p.useState)(!1),C=o?.currentItem?.track,P=o?.container,$=C||P||o?.currentItem,M=o?.playbackState==="PLAYBACK_STATE_PLAYING"||o?.state==="PLAYBACK_STATE_PLAYING"||o?.playbackState==="PLAYING"||o?.state==="PLAYING",A=C?.imageUrl||P?.imageUrl||$?.imageUrl,z=C?.name||P?.name||$?.name||"No Music Playing",T=C?.artist?.name||C?.podcast?.name||P?.name||"Unknown Artist",E=o?.positionMillis||o?.playbackPositionMillis||0,R=o?.durationMillis||$?.durationMillis||o?.currentItem?.track?.durationMillis||0;(0,p.useEffect)(()=>{o?.playModes&&(k(o.playModes.shuffle??!1),S(o.playModes.repeat??!1))},[o?.playModes]),(0,p.useEffect)(()=>{null!=E&&j(E)},[E]),(0,p.useEffect)(()=>{if(!M||0===R)return;let e=setInterval(()=>{j(e=>{let t=e+1e3;return t>=R?R:t})},1e3);return()=>clearInterval(e)},[M,R]);let F=R>0?v/R*100:0,O=async()=>{if(!(h.length<2))try{console.log("Selected zone IDs:",h),console.log("Groups:",d);let e=[];for(let t of h){let r=d.find(e=>e.id===t);if(console.log(`Processing zone ${t}:`,r),r){if(r.players&&Array.isArray(r.players)&&r.players.forEach(t=>{let r=t.id||t.playerId||t.player?.id;console.log("Found player in group.players:",t,`ID: ${r}`),r&&!e.includes(r)&&e.push(r)}),r.playerIds&&Array.isArray(r.playerIds)&&r.playerIds.forEach(t=>{console.log(`Found playerId in group.playerIds: ${t}`),t&&!e.includes(t)&&e.push(t)}),r.id&&r.id.includes(":")){let t=r.id.split(":")[0];console.log(`Extracted player ID from group ID: ${t}`),t&&!e.includes(t)&&e.push(t)}r.coordinatorId&&!e.includes(r.coordinatorId)&&(console.log(`Found coordinatorId: ${r.coordinatorId}`),e.push(r.coordinatorId))}}if(0===e.length)return void console.error("No player IDs found for selected zones");let t=h[0];console.log("Grouping zones:",{targetGroupId:t,playerIds:e});let r=await fetch("/api/sonos/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:t,playerIds:e})});if(!r.ok){let e=await r.json().catch(()=>({error:"Failed to parse error response"}));console.error("Group API error:",{status:r.status,statusText:r.statusText,error:e}),alert(`Failed to group zones: ${e.error||e.details||"Unknown error"}`);return}await l(),await new Promise(e=>setTimeout(e,1e3)),await l();let a=(await fetch("/api/sonos/state").then(e=>e.json()).then(e=>e.groups||[])).find(e=>e.id===t);a&&(g(a),y([t]))}catch(e){console.error("Failed to group zones:",e)}},L=async()=>{try{await l()}catch(e){console.error("Failed to ungroup zones:",e)}},q=async e=>{if(1===h.length||0===h.length){let t=h[0]||a?.id;if(!t)return;(await fetch(`/api/sonos/control?groupId=${t}&command=${e}`,{method:"POST"})).ok&&(await l(),setTimeout(()=>l(),500));return}if(h.length>1){await O();let t=h[0];if(t){let r=await fetch(`/api/sonos/control?groupId=${t}&command=${e}`,{method:"POST"});410===r.status?await l():r.ok&&(await l(),setTimeout(()=>l(),500))}}},G=async()=>{await q(M?"pause":"play")},Y=async e=>{await q(e)},V=async e=>{if(!a||0===R)return;let t=Math.floor(R*(e[0]/100));j(t);try{let e=await fetch(`/api/sonos/seek?groupId=${a.id}&positionMillis=${t}`,{method:"POST"});if(410===e.status)await l();else if(e.ok)await l(),setTimeout(()=>{l()},500);else{let t=await e.json().catch(()=>({}));console.error("Seek failed:",t)}}catch(e){console.error("Seek failed:",e)}},Z=async()=>{if(!a)return;let e=!w;k(e);try{(await fetch(`/api/sonos/control?groupId=${a.id}&shuffle=${e}`,{method:"POST"})).ok?await l():k(!e)}catch(t){console.error("Failed to toggle shuffle:",t),k(!e)}},K=async()=>{if(!a)return;let e=!N;S(e);try{(await fetch(`/api/sonos/control?groupId=${a.id}&repeat=${e}`,{method:"POST"})).ok?await l():S(!e)}catch(t){console.error("Failed to toggle repeat:",t),S(!e)}};return(0,t.jsxs)(m.motion.div,{initial:{opacity:0,scale:1.05},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.6,ease:[.22,1,.36,1]},className:"fixed inset-0 z-[200] bg-background flex flex-col p-6 sm:p-10 md:p-12 overflow-hidden select-none",children:[(0,t.jsx)("div",{className:"absolute inset-0 z-[-1] overflow-hidden pointer-events-none",children:A?(0,t.jsxs)(m.motion.div,{initial:{opacity:0},animate:{opacity:.5},transition:{duration:1.5},className:"relative h-full w-full",children:[(0,t.jsx)("img",{src:A,alt:"Background",className:"w-full h-full object-cover blur-[120px] saturate-[1.5] brightness-[0.3] scale-110"}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-background"})]}):(0,t.jsx)("div",{className:"h-full w-full bg-secondary/10"})}),(0,t.jsxs)("header",{className:"w-full max-w-7xl mx-auto flex items-center justify-between z-10 shrink-0 h-20 sm:h-24",children:[(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>{c(!1),e()},className:"h-12 w-12 sm:h-14 sm:w-14 rounded-2xl glass hover:bg-white/10 transition-all duration-500 group",children:(0,t.jsx)(eH,{className:"h-8 w-8 group-hover:translate-y-1 transition-transform"})}),(0,t.jsxs)("div",{className:"text-center flex-1 flex flex-col items-center",children:[(0,t.jsx)("p",{className:"text-[10px] font-black uppercase tracking-[0.5em] text-primary mb-1 opacity-70 dark:opacity-60",children:"Atmosphere"}),(0,t.jsx)("h2",{className:"text-lg sm:text-xl font-black italic uppercase tracking-tighter leading-none truncate max-w-[200px] sm:max-w-md",children:h.length>1?`${h.length} Zones`:a?.name||"No Zone Selected"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(eB,{selectedZoneIds:h,onZoneToggle:f,onGroupZones:O,onUngroupZones:L,compact:!1}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-12 w-12 sm:h-14 sm:w-14 rounded-2xl glass hover:bg-white/10 transition-all duration-500",children:(0,t.jsx)(I,{className:"h-6 w-6"})})]})]}),(0,t.jsxs)("main",{className:"w-full max-w-7xl mx-auto flex-1 min-h-0 flex flex-col lg:flex-row items-center justify-center gap-8 md:gap-12 lg:gap-20 z-10 py-4 sm:py-8 overflow-y-auto no-scrollbar",children:[(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center w-full min-h-0 max-h-[40vh] lg:max-h-[60vh]",children:(0,t.jsx)(m.motion.div,{layoutId:"artwork",className:"relative aspect-square h-full max-w-full rounded-[2.5rem] lg:rounded-[4rem] overflow-hidden shadow-[0_40px_100px_-20px_rgba(0,0,0,0.5)] border border-white/5 bg-secondary/20",children:A?(0,t.jsx)("img",{src:A,alt:z,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center italic",children:(0,t.jsx)("span",{className:"text-foreground/5 text-9xl font-black",children:"S"})})})}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col justify-center w-full max-w-2xl text-center lg:text-left space-y-8 sm:space-y-12 shrink-0",children:[(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)(m.motion.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3},className:"space-y-2 sm:space-y-4",children:[(0,t.jsx)("h1",{className:"text-4xl sm:text-5xl md:text-6xl xl:text-7xl 2xl:text-8xl font-black tracking-tighter italic uppercase leading-[0.9] text-balance",children:z}),(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3 lg:gap-8",children:[(0,t.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-foreground/40 tracking-tight uppercase italic truncate",children:T}),(0,t.jsx)("div",{className:"hidden lg:block h-px w-12 bg-primary/20"}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,t.jsx)("span",{className:"text-[9px] font-black uppercase tracking-[0.3em] px-3 py-1 glass rounded-full text-primary border-primary/20",children:"Ultra HD"}),(0,t.jsx)(b,{className:"h-6 w-6 text-muted-foreground opacity-60 dark:opacity-50 hover:text-red-500 transition-colors cursor-pointer"})]})]})]})}),(0,t.jsxs)("div",{className:"space-y-8 sm:space-y-12",children:[(0,t.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,t.jsx)(eE,{value:[F],onValueChange:V,max:100,step:.1,className:"w-full h-1.5 sm:h-2 cursor-pointer"}),(0,t.jsxs)("div",{className:"flex justify-between text-[10px] font-black tracking-[0.3em] text-muted-foreground opacity-70 dark:opacity-60 uppercase",children:[(0,t.jsx)("span",{children:eV(v)}),(0,t.jsx)("span",{children:eV(R)})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between lg:justify-start lg:gap-12",children:[(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:Z,className:(0,u.cn)("h-10 w-10 transition-all",w?"text-primary opacity-100":"text-muted-foreground opacity-70 dark:opacity-60 hover:text-primary"),children:(0,t.jsx)(U,{className:"h-6 w-6"})}),(0,t.jsxs)("div",{className:"flex items-center gap-8 sm:gap-12",children:[(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-14 w-14 text-foreground/40 hover:text-foreground transition-all hover:scale-110 active:scale-95",onClick:()=>Y("skipToPreviousTrack"),children:(0,t.jsx)(B,{className:"h-10 w-10 fill-current"})}),(0,t.jsx)(s.Button,{variant:"default",size:"icon",className:"h-24 w-24 sm:h-32 sm:w-32 rounded-[2.5rem] sm:rounded-[3.5rem] bg-foreground text-background hover:scale-105 active:scale-90 transition-all shadow-2xl border-4 border-white/5 shrink-0",onClick:G,children:M?(0,t.jsx)(_,{className:"h-10 w-10 sm:h-14 sm:w-14 fill-current"}):(0,t.jsx)(x,{className:"h-10 w-10 sm:h-14 sm:w-14 fill-current ml-1.5"})}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-14 w-14 text-foreground/40 hover:text-foreground transition-all hover:scale-110 active:scale-95",onClick:()=>Y("skipToNextTrack"),children:(0,t.jsx)(D,{className:"h-10 w-10 fill-current"})})]}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:K,className:(0,u.cn)("h-10 w-10 transition-all",N?"text-primary opacity-100":"text-muted-foreground opacity-70 dark:opacity-60 hover:text-primary"),children:(0,t.jsx)(H,{className:"h-6 w-6"})})]})]})]})]}),(0,t.jsx)("footer",{className:"w-full max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-6 sm:gap-10 z-10 pt-6 sm:pt-10 border-t border-white/5 shrink-0 h-32 sm:h-24 mb-4 sm:mb-0",children:(0,t.jsx)("div",{className:"flex items-center gap-3 w-full sm:w-auto px-6 py-3 glass rounded-2xl",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(eY,{selectedZoneIds:h.length>0?h:a?[a.id]:[],compact:!1})})})]})}function eK(){let{currentGroup:e,playbackState:a,volume:o,setVolume:i,refreshState:n,isExpanded:l,setIsExpanded:c,groups:d,selectedZoneIds:h,toggleZone:f,setCurrentGroup:g,setSelectedZoneIds:y}=(0,r.useSonos)(),[v,j]=(0,p.useState)(!1),[b,w]=(0,p.useState)(!1);if((0,p.useEffect)(()=>{a?.playModes&&(j(a.playModes.shuffle??!1),w(a.playModes.repeat??!1))},[a?.playModes]),!e)return null;let N=a?.currentItem?.track,I=a?.container,S=N||I||a?.currentItem,C=a?.playbackState==="PLAYBACK_STATE_PLAYING"||a?.state==="PLAYBACK_STATE_PLAYING"||a?.playbackState==="PLAYING"||a?.state==="PLAYING",P=N?.imageUrl||I?.imageUrl||S?.imageUrl,$=N?.name||I?.name||S?.name||"No Music Playing",M=N?.artist?.name||N?.podcast?.name||I?.name||"Unknown Artist",A=async e=>{e.stopPropagation(),await R(C?"pause":"play")},z=async(e,t)=>{e.stopPropagation(),await R(t)},T=async()=>{if(!(h.length<2))try{console.log("Selected zone IDs:",h),console.log("Groups:",d);let e=[];for(let t of h){let r=d.find(e=>e.id===t);if(console.log(`Processing zone ${t}:`,r),r){if(r.players&&Array.isArray(r.players)&&r.players.forEach(t=>{let r=t.id||t.playerId||t.player?.id;console.log("Found player in group.players:",t,`ID: ${r}`),r&&!e.includes(r)&&e.push(r)}),r.playerIds&&Array.isArray(r.playerIds)&&r.playerIds.forEach(t=>{console.log(`Found playerId in group.playerIds: ${t}`),t&&!e.includes(t)&&e.push(t)}),r.id&&r.id.includes(":")){let t=r.id.split(":")[0];console.log(`Extracted player ID from group ID: ${t}`),t&&!e.includes(t)&&e.push(t)}r.coordinatorId&&!e.includes(r.coordinatorId)&&(console.log(`Found coordinatorId: ${r.coordinatorId}`),e.push(r.coordinatorId))}}if(0===e.length)return void console.error("No player IDs found for selected zones");let t=h[0];console.log("Grouping zones:",{targetGroupId:t,playerIds:e});let r=await fetch("/api/sonos/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:t,playerIds:e})});if(!r.ok){let e=await r.json().catch(()=>({error:"Failed to parse error response"}));console.error("Group API error:",{status:r.status,statusText:r.statusText,error:e}),alert(`Failed to group zones: ${e.error||e.details||"Unknown error"}`);return}await n(),await new Promise(e=>setTimeout(e,1e3)),await n();let a=(await fetch("/api/sonos/state").then(e=>e.json()).then(e=>e.groups||[])).find(e=>e.id===t);a&&(g(a),y([t]))}catch(e){console.error("Failed to group zones:",e)}},E=async()=>{try{await n()}catch(e){console.error("Failed to ungroup zones:",e)}},R=async t=>{if(1===h.length||0===h.length){let r=h[0]||e?.id;if(!r)return;let a=await fetch(`/api/sonos/control?groupId=${r}&command=${t}`,{method:"POST"});410===a.status?await n():a.ok&&(await n(),setTimeout(()=>n(),500));return}if(h.length>1){await T();let e=h[0];e&&(await fetch(`/api/sonos/control?groupId=${e}&command=${t}`,{method:"POST"})).ok&&(await n(),setTimeout(()=>n(),500))}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.motion.div,{initial:{y:40,opacity:0},animate:{y:0,opacity:1},transition:{delay:.8,duration:1,ease:[.22,1,.36,1]},onClick:()=>c(!0),className:"h-28 glass-light rounded-[3rem] p-4 shadow-[0_40px_80px_-20px_rgba(0,0,0,0.4)] flex items-center justify-between gap-8 border border-white/10 group cursor-pointer hover:bg-white/10 dark:hover:bg-black/40 transition-all duration-700",children:[(0,t.jsxs)("div",{className:"flex items-center gap-6 w-[35%] min-w-0",children:[(0,t.jsxs)("div",{className:"h-20 w-20 rounded-[2rem] overflow-hidden flex-shrink-0 shadow-2xl relative group-hover:scale-105 transition-transform duration-700 border border-white/5 bg-secondary",children:[P?(0,t.jsx)("img",{src:P,alt:$,className:"w-full h-full object-cover saturate-125"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsx)(k,{className:"h-8 w-8 text-muted-foreground opacity-20 animate-spin-slow"})}),C&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/20 backdrop-blur-[2px] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex gap-1.5 items-end h-6",children:[(0,t.jsx)(m.motion.div,{animate:{height:[4,16,8,20,4]},transition:{repeat:1/0,duration:1},className:"w-1 bg-white rounded-full"}),(0,t.jsx)(m.motion.div,{animate:{height:[8,4,16,4,12]},transition:{repeat:1/0,duration:.8},className:"w-1 bg-white rounded-full"}),(0,t.jsx)(m.motion.div,{animate:{height:[12,16,4,16,8]},transition:{repeat:1/0,duration:1.2},className:"w-1 bg-white rounded-full"})]})})]}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,t.jsx)("span",{className:"font-black text-[22px] tracking-tighter truncate uppercase italic leading-none mb-1.5",children:$}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-primary opacity-90 dark:opacity-80",children:"Artist"}),(0,t.jsx)("span",{className:"text-[13px] font-bold text-muted-foreground truncate uppercase tracking-widest opacity-70 dark:opacity-60",children:M})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-10",children:[(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-14 w-14 text-muted-foreground hover:text-foreground transition-all group/btn",onClick:e=>z(e,"skipToPreviousTrack"),children:(0,t.jsx)(B,{className:"h-8 w-8 fill-current transition-transform group-active/btn:scale-90"})}),(0,t.jsx)(s.Button,{variant:"default",size:"icon",className:"h-20 w-20 rounded-[2rem] bg-foreground text-background hover:scale-105 active:scale-90 transition-all shadow-[0_20px_40px_-8px_rgba(0,0,0,0.3)] dark:shadow-primary/20 border-4 border-white/5",onClick:A,children:C?(0,t.jsx)(_,{className:"h-10 w-10 fill-current"}):(0,t.jsx)(x,{className:"h-10 w-10 fill-current ml-1.5"})}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-14 w-14 text-muted-foreground hover:text-foreground transition-all group/btn",onClick:e=>z(e,"skipToNextTrack"),children:(0,t.jsx)(D,{className:"h-8 w-8 fill-current transition-transform group-active/btn:scale-90"})})]}),(0,t.jsx)("div",{className:"flex items-center justify-end gap-8 w-[35%]",children:(0,t.jsxs)("div",{className:"hidden xl:flex items-center gap-3 pr-4",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)(eY,{selectedZoneIds:h.length>0?h:e?[e.id]:[],compact:!0}),(0,t.jsx)(eB,{selectedZoneIds:h,onZoneToggle:f,onGroupZones:T,onUngroupZones:E,compact:!0}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:async t=>{if(t.stopPropagation(),!e)return;let r=!v;j(r);try{(await fetch(`/api/sonos/control?groupId=${e.id}&shuffle=${r}`,{method:"POST"})).ok?await n():j(!r)}catch(e){console.error("Failed to toggle shuffle:",e),j(!r)}},className:(0,u.cn)("h-14 w-14 rounded-[1.75rem] glass transition-all",v?"bg-primary/20 text-primary":"hover:bg-primary/10 text-muted-foreground"),children:(0,t.jsx)(U,{className:"h-6 w-6"})}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:async t=>{if(t.stopPropagation(),!e)return;let r=!b;w(r);try{(await fetch(`/api/sonos/control?groupId=${e.id}&repeat=${r}`,{method:"POST"})).ok?await n():w(!r)}catch(e){console.error("Failed to toggle repeat:",e),w(!r)}},className:(0,u.cn)("h-14 w-14 rounded-[1.75rem] glass transition-all",b?"bg-primary/20 text-primary":"hover:bg-primary/10 text-muted-foreground"),children:(0,t.jsx)(H,{className:"h-6 w-6"})}),(0,t.jsx)(s.Button,{variant:"secondary",size:"icon",className:"h-14 w-14 rounded-[1.75rem] bg-primary text-primary-foreground hover:scale-105 transition-all shadow-lg",onClick:e=>{e.stopPropagation(),c(!0)},children:(0,t.jsx)(L,{className:"h-6 w-6"})})]})})]}),(0,t.jsx)(e_.AnimatePresence,{children:l&&(0,t.jsx)(eZ,{onClose:()=>c(!1)})})]})}let eW=(0,o.default)("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]),eJ=(0,o.default)("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),eX=(0,o.default)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),eQ=(0,o.default)("command",[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]]);function e0(){let{currentGroup:e,isExpanded:s,currentPage:o,setCurrentPage:i}=(0,r.useSonos)(),{deviceType:n}=(0,a.useDevice)(),[l,c]=(0,p.useState)(!0),[d,h]=(0,p.useState)(!0),x=null!==n;return(0,p.useEffect)(()=>{let e=localStorage.getItem("theme");if(null!==e){let t="dark"===e;c(t),t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}else c(!0),document.documentElement.classList.add("dark")},[]),(0,p.useEffect)(()=>{l?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},[l]),(0,t.jsxs)("div",{className:(0,u.cn)("flex h-screen bg-background text-foreground transition-colors duration-1000 overflow-hidden font-sans",x&&"device-responsive"),children:[(0,t.jsxs)("div",{className:"fixed inset-0 z-0 pointer-events-none overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute top-[-10%] left-[-5%] w-[50%] h-[50%] bg-primary/5 blur-[150px] rounded-full"}),(0,t.jsx)("div",{className:"absolute bottom-[-10%] right-[-5%] w-[40%] h-[40%] bg-foreground/3 blur-[120px] rounded-full"})]}),(0,t.jsx)(e_.AnimatePresence,{children:d&&!s&&(0,t.jsxs)(m.motion.aside,{initial:{x:-320,opacity:0},animate:{x:0,opacity:1},exit:{x:-320,opacity:0},transition:{type:"spring",damping:35,stiffness:250},className:"fixed lg:relative z-50 h-full w-[300px] flex flex-col border-r border-foreground/[0.03]",children:[(0,t.jsx)("div",{className:"p-10 pb-6 shrink-0",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 group cursor-pointer",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-foreground flex items-center justify-center transition-all duration-500 group-hover:scale-110 shadow-lg",children:(0,t.jsx)(eQ,{className:"text-background h-5 w-5"})}),(0,t.jsx)("span",{className:"text-lg font-black tracking-[0.2em] uppercase italic opacity-90 leading-none",children:"Stream"})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto no-scrollbar py-6",children:(0,t.jsx)(f,{isCollapsed:!1})}),(0,t.jsxs)("div",{className:"p-10 shrink-0 space-y-6",children:[(0,t.jsxs)("button",{onClick:()=>c(!l),className:"w-full h-12 rounded-full border border-foreground/[0.05] hover:bg-foreground/[0.03] flex items-center justify-between px-6 transition-all duration-300 group",children:[(0,t.jsx)("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-muted-foreground group-hover:text-foreground transition-colors",children:l?"Night":"Day"}),(0,t.jsxs)("div",{className:"relative h-4 w-4",children:[(0,t.jsx)(eJ,{className:(0,u.cn)("absolute inset-0 h-4 w-4 transition-all duration-700",l?"scale-0 rotate-90":"scale-100 rotate-0 text-amber-500")}),(0,t.jsx)(eW,{className:(0,u.cn)("absolute inset-0 h-4 w-4 transition-all duration-700",l?"scale-100 rotate-0 text-foreground":"scale-0 -rotate-90")})]})]}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("p",{className:"text-[8px] font-black uppercase tracking-[0.5em] text-muted-foreground opacity-60 dark:opacity-40 italic",children:"V 1.0 Architectural"})})]})]})}),(0,t.jsxs)("main",{className:"flex-1 flex flex-col h-full relative z-10 overflow-hidden",children:[!s&&(0,t.jsxs)("header",{className:"h-32 px-12 lg:px-20 flex items-center justify-between shrink-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-10",children:[(0,t.jsxs)("button",{onClick:()=>h(!d),className:"h-10 w-10 rounded-full border border-foreground/[0.05] hover:bg-foreground/[0.03] flex items-center justify-center transition-all group relative overflow-hidden",children:[(0,t.jsx)(eX,{className:(0,u.cn)("h-4 w-4 transition-transform duration-500",d?"translate-y-10 scale-0":"translate-y-0 scale-100")}),(0,t.jsx)(eR,{className:(0,u.cn)("absolute h-4 w-4 transition-transform duration-500",d?"translate-y-0 scale-100":"-translate-y-10 scale-0")})]}),(0,t.jsx)(e_.AnimatePresence,{mode:"wait",children:(0,t.jsxs)(m.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-0.5",children:[(0,t.jsx)("p",{className:"text-[9px] font-black uppercase tracking-[0.6em] text-primary opacity-70 dark:opacity-60",children:"Environment"}),(0,t.jsx)("h2",{className:"text-4xl lg:text-5xl font-black tracking-tighter italic uppercase leading-none text-foreground",children:e?.name||"Lobby"})]},e?.id||"empty")})]}),(0,t.jsx)("div",{className:"hidden md:flex items-center gap-8",children:(0,t.jsx)("div",{className:"flex gap-4",children:(0,t.jsx)("button",{onClick:()=>i("Settings"),className:(0,u.cn)("h-10 w-10 rounded-full border border-foreground/[0.05] hover:bg-foreground/[0.03] flex items-center justify-center transition-all","Settings"===o?"text-foreground bg-foreground/[0.05]":"text-muted-foreground hover:text-foreground"),children:(0,t.jsx)($,{className:"h-4 w-4"})})})})]}),(0,t.jsx)("section",{className:(0,u.cn)("flex-1 overflow-y-auto no-scrollbar pt-4 pb-48",s?"px-0":x?"px-8":"px-12 lg:px-20"),children:!s&&(0,t.jsxs)(t.Fragment,{children:["Feed"===o&&(0,t.jsx)(j,{}),"Library"===o&&(0,t.jsx)(P,{}),"Settings"===o&&(0,t.jsx)(O,{}),"Broadcast"===o&&(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("p",{className:"text-muted-foreground uppercase tracking-widest",children:"Broadcast Coming Soon"})}),"Curated"===o&&(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("p",{className:"text-muted-foreground uppercase tracking-widest",children:"Curated Coming Soon"})})]})}),"Settings"!==o&&(0,t.jsx)("div",{className:(0,u.cn)("absolute bottom-12 left-0 right-0 pointer-events-none",x?"px-8":"px-12 lg:px-20"),children:(0,t.jsx)("div",{className:"max-w-6xl mx-auto pointer-events-auto",children:(0,t.jsx)(eK,{})})})]})]})}e.s(["Dashboard",()=>e0],75170)},18566,(e,t,r)=>{t.exports=e.r(76562)},43240,e=>{"use strict";var t=e.i(71645),r=e.i(18566),a=e.i(52729);function s(){let e=(0,r.useSearchParams)(),s=(0,r.useRouter)(),{setCurrentPage:o}=(0,a.useSonos)();return(0,t.useEffect)(()=>{let t=e.get("spotify_connected"),r=e.get("error");"true"===t?(o("Settings"),s.replace("/")):r&&(o("Settings"),s.replace("/"))},[e,s,o]),null}e.s(["SpotifyCallbackHandler",()=>s])}]);