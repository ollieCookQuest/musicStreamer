module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},63021,(e,t,r)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},43793,e=>{"use strict";var t=e.i(63021);let r=e.g.prisma||new t.PrismaClient({log:["query"]});e.s(["prisma",0,r])},92123,e=>{"use strict";var t=e.i(43793);let r=process.env.SONOS_CLIENT_ID,o=process.env.SONOS_CLIENT_SECRET,a=process.env.SONOS_CALLBACK_URL,n="https://api.sonos.com/login/v3/oauth/access";function s(){let e=new URLSearchParams({client_id:r,response_type:"code",state:"sonos-auth",scope:"playback-control-all",redirect_uri:a});return`https://api.sonos.com/login/v3/oauth?${e.toString()}`}async function i(e){let s=Buffer.from(`${r}:${o}`).toString("base64"),i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${s}`},body:new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:a})});if(!i.ok){let e=await i.text();throw Error(`Failed to exchange code: ${e}`)}let c=await i.json();return await t.prisma.account.create({data:{service:"sonos",accessToken:c.access_token,refreshToken:c.refresh_token,expiresAt:new Date(Date.now()+1e3*c.expires_in)}}),c}async function c(){let e=await t.prisma.account.findFirst({where:{service:"sonos"},orderBy:{createdAt:"desc"}});if(!e)return null;if(e.expiresAt.getTime()>Date.now()+6e4)return e.accessToken;let a=Buffer.from(`${r}:${o}`).toString("base64"),s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${a}`},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e.refreshToken})});if(!s.ok)throw Error("Failed to refresh token");let i=await s.json();return(await t.prisma.account.update({where:{id:e.id},data:{accessToken:i.access_token,refreshToken:i.refresh_token||e.refreshToken,expiresAt:new Date(Date.now()+1e3*i.expires_in)}})).accessToken}async function l(e,t={}){let r=await c();if(!r)throw Error("No valid token");let o=await fetch(`https://api.ws.sonos.com/control/api/v1${e}`,{...t,headers:{...t.headers,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!o.ok){let e,t=await o.text();try{e=JSON.parse(t)}catch{e={errorCode:"UNKNOWN",message:t}}let r=Error(`Sonos API error: ${t}`);throw r.errorCode=e.errorCode||"UNKNOWN",r.errorData=e,r}return o.json()}async function d(){return l("/households")}async function u(e){return l(`/households/${e}/groups`)}async function p(e){return l(`/households/${e}/favorites`)}async function h(e){return l(`/groups/${e}/playback`)}async function y(e){return l(`/groups/${e}/playbackMetadata`)}async function f(e,t){return l(`/groups/${e}/favorites`,{method:"POST",body:JSON.stringify({favoriteId:t,action:"replace"})})}async function m(e,t){return l(`/groups/${e}/playback/${t}`,{method:"POST"})}async function g(e){return l(`/groups/${e}/groupVolume`)}async function b(e,t){return l(`/groups/${e}/groupVolume`,{method:"POST",body:JSON.stringify({volume:t})})}async function w(e){return l(`/players/${e}/playerVolume`)}async function v(e,t){return l(`/players/${e}/playerVolume`,{method:"POST",body:JSON.stringify({volume:t})})}async function S(e,t){return l(`/groups/${e}/playback/seek`,{method:"POST",body:JSON.stringify({positionMillis:t})})}async function x(e,t,r){return l(`/groups/${e}/playback/playMode`,{method:"POST",body:JSON.stringify({playModes:{shuffle:t,repeat:r}})})}async function T(e){return l(`/households/${e}/musicServiceAccounts`)}async function O(e,t,r,o){try{return await l(`/households/${e}/musicServiceAccounts/${t}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:r,serviceId:o})})}catch(a){console.log("Search endpoint 1 failed, trying alternative...",a?.errorCode);try{return await l(`/households/${e}/musicServices/${o}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:r,accountId:t})})}catch(a){console.log("Search endpoint 2 failed, trying alternative...",a?.errorCode);try{return await l(`/households/${e}/musicServiceAccounts/${t}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:r,accountId:t,serviceId:o})})}catch(e){throw console.log("Search endpoint 3 failed",e?.errorCode),Error(`Search not available: ${e?.errorCode||e?.message||"Unknown error"}`)}}}}async function R(e,t,r,o){return l(`/households/${e}/musicServiceAccounts/${t}/getMetadata`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:o,objectId:r,accountId:t}})})}async function $(e,t,r,o){let a;a=o?`/households/${e}/musicServiceAccounts/${r}/containers/${o}`:`/households/${e}/musicServiceAccounts/${r}/containers`;try{return await l(a)}catch(a){try{let r=o?`/households/${e}/musicServices/${t}/containers/${o}`:`/households/${e}/musicServices/${t}/containers`;return await l(r)}catch(e){if(console.log("Browse endpoint not available, using fallback"),!o)return{containers:[{name:"Your Library",type:"library",id:{objectId:"spotify:user-library",serviceId:t,accountId:r},_objectType:"container"},{name:"Your Playlists",type:"playlists",id:{objectId:"spotify:user-playlists",serviceId:t,accountId:r},_objectType:"container"},{name:"Recently Played",type:"recent",id:{objectId:"spotify:recently-played",serviceId:t,accountId:r},_objectType:"container"},{name:"Search",type:"search",id:{objectId:"search",serviceId:t,accountId:r},_objectType:"container"}]};return{containers:[],items:[]}}}}async function N(e,t,r,o,a="replace"){return l(`/groups/${e}/playback/playItem`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:r,objectId:t,accountId:o},action:a})})}async function C(e,t,r,o,a){return l(`/households/${e}/favorites`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:r,objectId:t,accountId:o},name:a})})}async function P(e,t){let r=e.includes(":")?e.split(":")[0]:e,o=await d(),a=o.households?.[0]?.id;if(!a)throw Error("No household found");console.log("Grouping with coordinator:",r,"playerIds:",t,"householdId:",a);try{return await l(`/households/${a}/groups/${e}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(o){console.log("modifyGroupMembers endpoint failed, trying setGroupMembers...");try{return await l(`/households/${a}/groups/${e}/setGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(o){console.log("setGroupMembers with full groupId failed, trying with coordinator ID...");try{return await l(`/households/${a}/groups/${r}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(o){console.log("modifyGroupMembers with coordinatorId failed, trying setGroupMembers...");try{return await l(`/households/${a}/groups/${r}/setGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(r){console.log("setGroupMembers with coordinatorId failed, trying createGroup...");try{return await l(`/households/${a}/groups/createGroup`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(r){console.log("createGroup failed, trying direct group endpoints...");try{return await l(`/groups/${e}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(e){throw Error(`All grouping endpoints failed. Last error: ${r.message||e.message}`)}}}}}}}e.s(["addToFavorites",()=>C,"browseMusicService",()=>$,"exchangeCode",()=>i,"fetchFavorites",()=>p,"fetchGroups",()=>u,"fetchHouseholds",()=>d,"getAuthUrl",()=>s,"getMusicServiceAccounts",()=>T,"getMusicServiceMetadata",()=>R,"getPlaybackMetadata",()=>y,"getPlaybackStatus",()=>h,"getPlayerVolume",()=>w,"getVolume",()=>g,"loadFavorite",()=>f,"modifyGroupMembers",()=>P,"playItem",()=>N,"searchMusicService",()=>O,"seek",()=>S,"sendControl",()=>m,"setPlayModes",()=>x,"setPlayerVolume",()=>v,"setVolume",()=>b])},30387,e=>{"use strict";var t=e.i(47909),r=e.i(74017),o=e.i(96250),a=e.i(59756),n=e.i(61916),s=e.i(74677),i=e.i(69741),c=e.i(16795),l=e.i(87718),d=e.i(95169),u=e.i(47587),p=e.i(66012),h=e.i(70101),y=e.i(26937),f=e.i(10372),m=e.i(93695);e.i(52474);var g=e.i(220),b=e.i(89171),w=e.i(92123);async function v(e){let{searchParams:t}=new URL(e.url),r=t.get("accountId"),o=t.get("itemId"),a=t.get("serviceId");if(!r||!o||!a)return b.NextResponse.json({error:"Missing required parameters"},{status:400});try{let e=(await (0,w.fetchHouseholds)()).households;if(!e||0===e.length)return b.NextResponse.json({error:"No households found"},{status:404});let t=e[0].id,n=await (0,w.getMusicServiceMetadata)(t,r,o,a);return b.NextResponse.json(n)}catch(e){return console.error("Metadata API error:",e),b.NextResponse.json({error:"Failed to fetch metadata",details:e.message},{status:500})}}e.s(["GET",()=>v],76602);var S=e.i(76602);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/sonos/library/metadata/route",pathname:"/api/sonos/library/metadata",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/sonos/library/metadata/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:T,workUnitAsyncStorage:O,serverHooks:R}=x;function $(){return(0,o.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:O})}async function N(e,t,o){x.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let b="/api/sonos/library/metadata/route";b=b.replace(/\/index$/,"")||"/";let w=await x.prepare(e,t,{srcPage:b,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:v,params:S,nextConfig:T,parsedUrl:O,isDraftMode:R,prerenderManifest:$,routerServerContext:N,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,resolvedPathname:I,clientReferenceManifest:k,serverActionsManifest:E}=w,A=(0,i.normalizeAppPath)(b),_=!!($.dynamicRoutes[A]||$.routes[I]),j=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,O,!1):t.end("This page could not be found"),null);if(_&&!R){let e=!!$.routes[I],t=$.dynamicRoutes[A];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await j();throw new m.NoFallbackError}}let M=null;!_||x.isDev||R||(M="/index"===(M=I)?"/":M);let U=!0===x.isDev||!_,q=_&&!U;E&&k&&(0,s.setManifestsSingleton)({page:b,clientReferenceManifest:k,serverActionsManifest:E});let D=e.method||"GET",G=(0,n.getTracer)(),H=G.getActiveScopeSpan(),J={params:S,prerenderManifest:$,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o,a)=>x.onRequestError(e,t,o,a,N)},sharedContext:{buildId:v}},L=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),B=l.NextRequestAdapter.fromNodeNextRequest(L,(0,l.signalFromNodeResponse)(t));try{let s=async e=>x.handle(B,J).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=G.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${D} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${b}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),c=async a=>{var n,c;let l=async({previousCacheEntry:r})=>{try{if(!i&&C&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(a);e.fetchMetrics=J.renderOpts.fetchMetrics;let c=J.renderOpts.pendingWaitUntil;c&&o.waitUntil&&(o.waitUntil(c),c=void 0);let l=J.renderOpts.collectedTags;if(!_)return await (0,p.sendResponse)(L,F,n,J.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==J.renderOpts.collectedRevalidate&&!(J.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&J.renderOpts.collectedRevalidate,o=void 0===J.renderOpts.collectedExpire||J.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:J.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,N),t}},d=await x.handleResponse({req:e,nextConfig:T,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:$,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,responseGenerator:l,waitUntil:o.waitUntil,isMinimalMode:i});if(!_)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&_||m.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,y.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(L,F,new Response(d.value.body,{headers:m,status:d.value.status||200})),null};H?await c(H):await G.withPropagatedContext(e.headers,()=>G.trace(d.BaseServerSpan.handleRequest,{spanName:`${D} ${b}`,kind:n.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},c))}catch(t){if(t instanceof m.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,N),_)throw t;return await (0,p.sendResponse)(L,F,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>$,"routeModule",()=>x,"serverHooks",()=>R,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>O],30387)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__75fc9686._.js.map