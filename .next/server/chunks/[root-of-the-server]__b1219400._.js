module.exports=[43793,e=>{"use strict";var r=e.i(63021);let t=e.g.prisma||new r.PrismaClient({log:["query"]});e.s(["prisma",0,t])},93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},70406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},63021,(e,r,t)=>{r.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},92123,e=>{"use strict";var r=e.i(43793);let t=process.env.SONOS_CLIENT_ID,o=process.env.SONOS_CLIENT_SECRET,s=process.env.SONOS_CALLBACK_URL,n="https://api.sonos.com/login/v3/oauth/access";function a(){let e=new URLSearchParams({client_id:t,response_type:"code",state:"sonos-auth",scope:"playback-control-all",redirect_uri:s});return`https://api.sonos.com/login/v3/oauth?${e.toString()}`}async function i(e){let a=Buffer.from(`${t}:${o}`).toString("base64"),i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${a}`},body:new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:s})});if(!i.ok){let e=await i.text();throw Error(`Failed to exchange code: ${e}`)}let c=await i.json();return await r.prisma.account.create({data:{service:"sonos",accessToken:c.access_token,refreshToken:c.refresh_token,expiresAt:new Date(Date.now()+1e3*c.expires_in)}}),c}async function c(){let e=await r.prisma.account.findFirst({where:{service:"sonos"},orderBy:{createdAt:"desc"}});if(!e)return null;if(e.expiresAt.getTime()>Date.now()+6e4)return e.accessToken;let s=Buffer.from(`${t}:${o}`).toString("base64"),a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${s}`},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e.refreshToken})});if(!a.ok)throw Error("Failed to refresh token");let i=await a.json();return(await r.prisma.account.update({where:{id:e.id},data:{accessToken:i.access_token,refreshToken:i.refresh_token||e.refreshToken,expiresAt:new Date(Date.now()+1e3*i.expires_in)}})).accessToken}async function d(e,r={}){let t=await c();if(!t)throw Error("No valid token");let o=await fetch(`https://api.ws.sonos.com/control/api/v1${e}`,{...r,headers:{...r.headers,Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!o.ok){let e,r=await o.text();try{e=JSON.parse(r)}catch{e={errorCode:"UNKNOWN",message:r}}let t=Error(`Sonos API error: ${r}`);throw t.errorCode=e.errorCode||"UNKNOWN",t.errorData=e,t}return o.json()}async function u(){return d("/households")}async function l(e){return d(`/households/${e}/groups`)}async function p(e){return d(`/households/${e}/favorites`)}async function y(e){return d(`/groups/${e}/playback`)}async function h(e){return d(`/groups/${e}/playbackMetadata`)}async function f(e,r){return d(`/groups/${e}/favorites`,{method:"POST",body:JSON.stringify({favoriteId:r,action:"replace"})})}async function m(e,r){return d(`/groups/${e}/playback/${r}`,{method:"POST"})}async function g(e){return d(`/groups/${e}/groupVolume`)}async function b(e,r){return d(`/groups/${e}/groupVolume`,{method:"POST",body:JSON.stringify({volume:r})})}async function S(e){return d(`/players/${e}/playerVolume`)}async function w(e,r){return d(`/players/${e}/playerVolume`,{method:"POST",body:JSON.stringify({volume:r})})}async function $(e,r){return d(`/groups/${e}/playback/seek`,{method:"POST",body:JSON.stringify({positionMillis:r})})}async function v(e,r,t){return d(`/groups/${e}/playback/playMode`,{method:"POST",body:JSON.stringify({playModes:{shuffle:r,repeat:t}})})}async function O(e){return d(`/households/${e}/musicServiceAccounts`)}async function x(e,r,t,o){try{return await d(`/households/${e}/musicServiceAccounts/${r}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:t,serviceId:o})})}catch(s){console.log("Search endpoint 1 failed, trying alternative...",s?.errorCode);try{return await d(`/households/${e}/musicServices/${o}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:t,accountId:r})})}catch(s){console.log("Search endpoint 2 failed, trying alternative...",s?.errorCode);try{return await d(`/households/${e}/musicServiceAccounts/${r}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:t,accountId:r,serviceId:o})})}catch(e){throw console.log("Search endpoint 3 failed",e?.errorCode),Error(`Search not available: ${e?.errorCode||e?.message||"Unknown error"}`)}}}}async function T(e,r,t,o){return d(`/households/${e}/musicServiceAccounts/${r}/getMetadata`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:o,objectId:t,accountId:r}})})}async function k(e,r,t,o){let s;s=o?`/households/${e}/musicServiceAccounts/${t}/containers/${o}`:`/households/${e}/musicServiceAccounts/${t}/containers`;try{return await d(s)}catch(s){try{let t=o?`/households/${e}/musicServices/${r}/containers/${o}`:`/households/${e}/musicServices/${r}/containers`;return await d(t)}catch(e){if(console.log("Browse endpoint not available, using fallback"),!o)return{containers:[{name:"Your Library",type:"library",id:{objectId:"spotify:user-library",serviceId:r,accountId:t},_objectType:"container"},{name:"Your Playlists",type:"playlists",id:{objectId:"spotify:user-playlists",serviceId:r,accountId:t},_objectType:"container"},{name:"Recently Played",type:"recent",id:{objectId:"spotify:recently-played",serviceId:r,accountId:t},_objectType:"container"},{name:"Search",type:"search",id:{objectId:"search",serviceId:r,accountId:t},_objectType:"container"}]};return{containers:[],items:[]}}}}async function I(e,r,t,o,s="replace"){return d(`/groups/${e}/playback/playItem`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:t,objectId:r,accountId:o},action:s})})}async function j(e,r,t,o,s){return d(`/households/${e}/favorites`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:t,objectId:r,accountId:o},name:s})})}async function P(e,r){let t=e.includes(":")?e.split(":")[0]:e,o=await u(),s=o.households?.[0]?.id;if(!s)throw Error("No household found");console.log("Grouping with coordinator:",t,"playerIds:",r,"householdId:",s);try{return await d(`/households/${s}/groups/${e}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:r})})}catch(o){console.log("modifyGroupMembers endpoint failed, trying setGroupMembers...");try{return await d(`/households/${s}/groups/${e}/setGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:r})})}catch(o){console.log("setGroupMembers with full groupId failed, trying with coordinator ID...");try{return await d(`/households/${s}/groups/${t}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:r})})}catch(o){console.log("modifyGroupMembers with coordinatorId failed, trying setGroupMembers...");try{return await d(`/households/${s}/groups/${t}/setGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:r})})}catch(t){console.log("setGroupMembers with coordinatorId failed, trying createGroup...");try{return await d(`/households/${s}/groups/createGroup`,{method:"POST",body:JSON.stringify({playerIds:r})})}catch(t){console.log("createGroup failed, trying direct group endpoints...");try{return await d(`/groups/${e}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:r})})}catch(e){throw Error(`All grouping endpoints failed. Last error: ${t.message||e.message}`)}}}}}}}e.s(["addToFavorites",()=>j,"browseMusicService",()=>k,"exchangeCode",()=>i,"fetchFavorites",()=>p,"fetchGroups",()=>l,"fetchHouseholds",()=>u,"getAuthUrl",()=>a,"getMusicServiceAccounts",()=>O,"getMusicServiceMetadata",()=>T,"getPlaybackMetadata",()=>h,"getPlaybackStatus",()=>y,"getPlayerVolume",()=>S,"getVolume",()=>g,"loadFavorite",()=>f,"modifyGroupMembers",()=>P,"playItem",()=>I,"searchMusicService",()=>x,"seek",()=>$,"sendControl",()=>m,"setPlayModes",()=>v,"setPlayerVolume",()=>w,"setVolume",()=>b])},20635,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b1219400._.js.map