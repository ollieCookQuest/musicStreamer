module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},63021,(e,t,r)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},43793,e=>{"use strict";var t=e.i(63021);let r=e.g.prisma||new t.PrismaClient({log:["query"]});e.s(["prisma",0,r])},92123,e=>{"use strict";var t=e.i(43793);let r=process.env.SONOS_CLIENT_ID,o=process.env.SONOS_CLIENT_SECRET,a=process.env.SONOS_CALLBACK_URL,s="https://api.sonos.com/login/v3/oauth/access";function n(){let e=new URLSearchParams({client_id:r,response_type:"code",state:"sonos-auth",scope:"playback-control-all",redirect_uri:a});return`https://api.sonos.com/login/v3/oauth?${e.toString()}`}async function i(e){let n=Buffer.from(`${r}:${o}`).toString("base64"),i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${n}`},body:new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:a})});if(!i.ok){let e=await i.text();throw Error(`Failed to exchange code: ${e}`)}let c=await i.json();return await t.prisma.account.create({data:{service:"sonos",accessToken:c.access_token,refreshToken:c.refresh_token,expiresAt:new Date(Date.now()+1e3*c.expires_in)}}),c}async function c(){let e=await t.prisma.account.findFirst({where:{service:"sonos"},orderBy:{createdAt:"desc"}});if(!e)return null;if(e.expiresAt.getTime()>Date.now()+6e4)return e.accessToken;let a=Buffer.from(`${r}:${o}`).toString("base64"),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${a}`},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e.refreshToken})});if(!n.ok)throw Error("Failed to refresh token");let i=await n.json();return(await t.prisma.account.update({where:{id:e.id},data:{accessToken:i.access_token,refreshToken:i.refresh_token||e.refreshToken,expiresAt:new Date(Date.now()+1e3*i.expires_in)}})).accessToken}async function l(e,t={}){let r=await c();if(!r)throw Error("No valid token");let o=await fetch(`https://api.ws.sonos.com/control/api/v1${e}`,{...t,headers:{...t.headers,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!o.ok){let e,t=await o.text();try{e=JSON.parse(t)}catch{e={errorCode:"UNKNOWN",message:t}}let r=Error(`Sonos API error: ${t}`);throw r.errorCode=e.errorCode||"UNKNOWN",r.errorData=e,r}return o.json()}async function u(){return l("/households")}async function d(e){return l(`/households/${e}/groups`)}async function p(e){return l(`/households/${e}/favorites`)}async function h(e){return l(`/groups/${e}/playback`)}async function y(e){return l(`/groups/${e}/playbackMetadata`)}async function f(e,t){return l(`/groups/${e}/favorites`,{method:"POST",body:JSON.stringify({favoriteId:t,action:"replace"})})}async function g(e,t){return l(`/groups/${e}/playback/${t}`,{method:"POST"})}async function m(e){return l(`/groups/${e}/groupVolume`)}async function w(e,t){return l(`/groups/${e}/groupVolume`,{method:"POST",body:JSON.stringify({volume:t})})}async function b(e){return l(`/players/${e}/playerVolume`)}async function v(e,t){return l(`/players/${e}/playerVolume`,{method:"POST",body:JSON.stringify({volume:t})})}async function S(e,t){return l(`/groups/${e}/playback/seek`,{method:"POST",body:JSON.stringify({positionMillis:t})})}async function x(e,t,r){return l(`/groups/${e}/playback/playMode`,{method:"POST",body:JSON.stringify({playModes:{shuffle:t,repeat:r}})})}async function O(e){return l(`/households/${e}/musicServiceAccounts`)}async function T(e,t,r,o){try{return await l(`/households/${e}/musicServiceAccounts/${t}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:r,serviceId:o})})}catch(a){console.log("Search endpoint 1 failed, trying alternative...",a?.errorCode);try{return await l(`/households/${e}/musicServices/${o}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:r,accountId:t})})}catch(a){console.log("Search endpoint 2 failed, trying alternative...",a?.errorCode);try{return await l(`/households/${e}/musicServiceAccounts/${t}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:r,accountId:t,serviceId:o})})}catch(e){throw console.log("Search endpoint 3 failed",e?.errorCode),Error(`Search not available: ${e?.errorCode||e?.message||"Unknown error"}`)}}}}async function R(e,t,r,o){return l(`/households/${e}/musicServiceAccounts/${t}/getMetadata`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:o,objectId:r,accountId:t}})})}async function $(e,t,r,o){let a;a=o?`/households/${e}/musicServiceAccounts/${r}/containers/${o}`:`/households/${e}/musicServiceAccounts/${r}/containers`;try{return await l(a)}catch(a){try{let r=o?`/households/${e}/musicServices/${t}/containers/${o}`:`/households/${e}/musicServices/${t}/containers`;return await l(r)}catch(e){if(console.log("Browse endpoint not available, using fallback"),!o)return{containers:[{name:"Your Library",type:"library",id:{objectId:"spotify:user-library",serviceId:t,accountId:r},_objectType:"container"},{name:"Your Playlists",type:"playlists",id:{objectId:"spotify:user-playlists",serviceId:t,accountId:r},_objectType:"container"},{name:"Recently Played",type:"recent",id:{objectId:"spotify:recently-played",serviceId:t,accountId:r},_objectType:"container"},{name:"Search",type:"search",id:{objectId:"search",serviceId:t,accountId:r},_objectType:"container"}]};return{containers:[],items:[]}}}}async function N(e,t,r,o,a="replace"){return l(`/groups/${e}/playback/playItem`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:r,objectId:t,accountId:o},action:a})})}async function C(e,t,r,o,a){return l(`/households/${e}/favorites`,{method:"POST",body:JSON.stringify({itemId:{_objectType:"universalMusicObjectId",serviceId:r,objectId:t,accountId:o},name:a})})}async function P(e,t){let r=e.includes(":")?e.split(":")[0]:e,o=await u(),a=o.households?.[0]?.id;if(!a)throw Error("No household found");console.log("Grouping with coordinator:",r,"playerIds:",t,"householdId:",a);try{return await l(`/households/${a}/groups/${e}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(o){console.log("modifyGroupMembers endpoint failed, trying setGroupMembers...");try{return await l(`/households/${a}/groups/${e}/setGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(o){console.log("setGroupMembers with full groupId failed, trying with coordinator ID...");try{return await l(`/households/${a}/groups/${r}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(o){console.log("modifyGroupMembers with coordinatorId failed, trying setGroupMembers...");try{return await l(`/households/${a}/groups/${r}/setGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(r){console.log("setGroupMembers with coordinatorId failed, trying createGroup...");try{return await l(`/households/${a}/groups/createGroup`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(r){console.log("createGroup failed, trying direct group endpoints...");try{return await l(`/groups/${e}/modifyGroupMembers`,{method:"POST",body:JSON.stringify({playerIds:t})})}catch(e){throw Error(`All grouping endpoints failed. Last error: ${r.message||e.message}`)}}}}}}}e.s(["addToFavorites",()=>C,"browseMusicService",()=>$,"exchangeCode",()=>i,"fetchFavorites",()=>p,"fetchGroups",()=>d,"fetchHouseholds",()=>u,"getAuthUrl",()=>n,"getMusicServiceAccounts",()=>O,"getMusicServiceMetadata",()=>R,"getPlaybackMetadata",()=>y,"getPlaybackStatus",()=>h,"getPlayerVolume",()=>b,"getVolume",()=>m,"loadFavorite",()=>f,"modifyGroupMembers",()=>P,"playItem",()=>N,"searchMusicService",()=>T,"seek",()=>S,"sendControl",()=>g,"setPlayModes",()=>x,"setPlayerVolume",()=>v,"setVolume",()=>w])},85151,e=>{"use strict";var t=e.i(47909),r=e.i(74017),o=e.i(96250),a=e.i(59756),s=e.i(61916),n=e.i(74677),i=e.i(69741),c=e.i(16795),l=e.i(87718),u=e.i(95169),d=e.i(47587),p=e.i(66012),h=e.i(70101),y=e.i(26937),f=e.i(10372),g=e.i(93695);e.i(52474);var m=e.i(220),w=e.i(89171),b=e.i(92123);async function v(e){try{let{groupId:t,playerIds:r}=await e.json();if(!t||!r||!Array.isArray(r))return w.NextResponse.json({error:"Missing required parameters",details:{groupId:!!t,playerIds:Array.isArray(r)}},{status:400});if(0===r.length)return w.NextResponse.json({error:"No player IDs provided",details:{groupId:t,playerIds:r}},{status:400});let o=await (0,b.modifyGroupMembers)(t,r);return w.NextResponse.json({success:!0,result:o})}catch(r){console.error("Group modification API error:",r);let e=r?.message||String(r),t=r?.errorCode||"UNKNOWN";return w.NextResponse.json({error:"Failed to modify group",details:e,errorCode:t,stack:void 0},{status:500})}}e.s(["POST",()=>v],58002);var S=e.i(58002);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/sonos/groups/route",pathname:"/api/sonos/groups",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/sonos/groups/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:O,workUnitAsyncStorage:T,serverHooks:R}=x;function $(){return(0,o.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:T})}async function N(e,t,o){x.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/sonos/groups/route";w=w.replace(/\/index$/,"")||"/";let b=await x.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:v,params:S,nextConfig:O,parsedUrl:T,isDraftMode:R,prerenderManifest:$,routerServerContext:N,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,resolvedPathname:k,clientReferenceManifest:I,serverActionsManifest:A}=b,E=(0,i.normalizeAppPath)(w),_=!!($.dynamicRoutes[E]||$.routes[k]),j=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,T,!1):t.end("This page could not be found"),null);if(_&&!R){let e=!!$.routes[k],t=$.dynamicRoutes[E];if(t&&!1===t.fallback&&!e){if(O.experimental.adapterPath)return await j();throw new g.NoFallbackError}}let M=null;!_||x.isDev||R||(M="/index"===(M=k)?"/":M);let U=!0===x.isDev||!_,q=_&&!U;A&&I&&(0,n.setManifestsSingleton)({page:w,clientReferenceManifest:I,serverActionsManifest:A});let D=e.method||"GET",G=(0,s.getTracer)(),H=G.getActiveScopeSpan(),J={params:S,prerenderManifest:$,renderOpts:{experimental:{authInterrupts:!!O.experimental.authInterrupts},cacheComponents:!!O.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:O.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o,a)=>x.onRequestError(e,t,o,a,N)},sharedContext:{buildId:v}},F=new c.NodeNextRequest(e),L=new c.NodeNextResponse(t),B=l.NextRequestAdapter.fromNodeNextRequest(F,(0,l.signalFromNodeResponse)(t));try{let n=async e=>x.handle(B,J).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=G.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${D} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${w}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),c=async a=>{var s,c;let l=async({previousCacheEntry:r})=>{try{if(!i&&C&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await n(a);e.fetchMetrics=J.renderOpts.fetchMetrics;let c=J.renderOpts.pendingWaitUntil;c&&o.waitUntil&&(o.waitUntil(c),c=void 0);let l=J.renderOpts.collectedTags;if(!_)return await (0,p.sendResponse)(F,L,s,J.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==J.renderOpts.collectedRevalidate&&!(J.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&J.renderOpts.collectedRevalidate,o=void 0===J.renderOpts.collectedExpire||J.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:J.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,N),t}},u=await x.handleResponse({req:e,nextConfig:O,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:$,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,responseGenerator:l,waitUntil:o.waitUntil,isMinimalMode:i});if(!_)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",C?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&_||g.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(F,L,new Response(u.value.body,{headers:g,status:u.value.status||200})),null};H?await c(H):await G.withPropagatedContext(e.headers,()=>G.trace(u.BaseServerSpan.handleRequest,{spanName:`${D} ${w}`,kind:s.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},c))}catch(t){if(t instanceof g.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,N),_)throw t;return await (0,p.sendResponse)(F,L,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>$,"routeModule",()=>x,"serverHooks",()=>R,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>T],85151)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__846772f1._.js.map